<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","width":250,"display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":15},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="MaxSoft">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="MaxSoft">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="maxsoft">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>MaxSoft</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">MaxSoft</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">「路漫漫其修远兮，吾将上下而求索」</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/03/24/SpringMVC%E7%BB%84%E4%BB%B6%E4%B9%8BThemeResolver/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/apple-touch-icon-next.png">
      <meta itemprop="name" content="maxsoft">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxSoft">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2014/03/24/SpringMVC%E7%BB%84%E4%BB%B6%E4%B9%8BThemeResolver/" class="post-title-link" itemprop="url">SpringMVC组件之ThemeResolver—Spring系列学习笔记</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表时间</span>

              <time title="创建时间：2014-03-24 21:22:20" itemprop="dateCreated datePublished" datetime="2014-03-24T21:22:20+08:00">2014-03-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E7%B3%BB%E5%88%97/" itemprop="url" rel="index">
                    <span itemprop="name">Spring系列</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="SpringMVC组件之ThemeResolver"><a href="#SpringMVC组件之ThemeResolver" class="headerlink" title="SpringMVC组件之ThemeResolver"></a>SpringMVC组件之ThemeResolver</h2><p>SpringMVC中的主题组件是通过ThemeResolver接口来进行设置完成。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ThemeResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">String <span class="title">resolveThemeName</span><span class="params">(HttpServletRequest request)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setThemeName</span><span class="params">(HttpServletRequest request, HttpServletResponse response, String themeName)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在源码中我看到接口ThemeResolver提供了俩个方法分别是：<br>1&gt;resolveThemeName(…) 解析主题信息，并返回其名称；<br>2&gt;setThemeName(…)设置主题名称；</p>
<p>在SpringMVC中直接实现ThemeResolver接口的子类有如下2个：<br>    1&gt; org.springframework.web.servlet.theme.AbstractThemeResolver<br>    2&gt; org.springframework.web.servlet.theme.CookieThemeResolver</p>
<h3 id="AbstractThemeResolver"><a href="#AbstractThemeResolver" class="headerlink" title="AbstractThemeResolver"></a>AbstractThemeResolver</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractThemeResolver</span> <span class="keyword">implements</span> <span class="title">ThemeResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String ORIGINAL_DEFAULT_THEME_NAME = <span class="string">"theme"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String defaultThemeName = ORIGINAL_DEFAULT_THEME_NAME;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDefaultThemeName</span><span class="params">(String defaultThemeName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.defaultThemeName = defaultThemeName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDefaultThemeName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.defaultThemeName;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过源码分析我们看到了，在抽象实现类AbstractThemeResolver中提供了设置默认主题的属性以及方法，以备子类共用使用；<br>其子类分别有以下2个：<br>    1&gt; org.springframework.web.servlet.theme.FixedThemeResolver<br>    2&gt; org.springframework.web.servlet.theme.SessionThemeResolver</p>
<h4 id="FixedThemeResolver"><a href="#FixedThemeResolver" class="headerlink" title="FixedThemeResolver"></a>FixedThemeResolver</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FixedThemeResolver</span> <span class="keyword">extends</span> <span class="title">AbstractThemeResolver</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">resolveThemeName</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> getDefaultThemeName();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setThemeName</span><span class="params">(HttpServletRequest request, HttpServletResponse response, String themeName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Cannot change theme - use a different theme resolution strategy"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过源码我们看到，FixedThemeResolver解析器只解析默认的主题，不支持主题切换。</p>
<h4 id="SessionThemeResolver"><a href="#SessionThemeResolver" class="headerlink" title="SessionThemeResolver"></a>SessionThemeResolver</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionThemeResolver</span> <span class="keyword">extends</span> <span class="title">AbstractThemeResolver</span> </span>&#123;</span><br><span class="line">	public static final String THEME_SESSION_ATTRIBUTE_NAME = SessionThemeResolver.class.getName() + ".THEME";</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">resolveThemeName</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		String themeName = (String) WebUtils.getSessionAttribute(request, THEME_SESSION_ATTRIBUTE_NAME);</span><br><span class="line">		<span class="keyword">return</span> (themeName != <span class="keyword">null</span> ? themeName : getDefaultThemeName());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setThemeName</span><span class="params">(HttpServletRequest request, HttpServletResponse response, String themeName)</span> </span>&#123;</span><br><span class="line">		WebUtils.setSessionAttribute(request, THEME_SESSION_ATTRIBUTE_NAME,</span><br><span class="line">				(StringUtils.hasText(themeName) ? themeName : <span class="keyword">null</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过源码我们可以理解SessionThemeResolver解析器的工作原理是通过在Session中动态的获取前端用户设置的主题信息来动态改变当前请求的Web网站系统的主题；如果获取到的主题名称为空，则显示系统的默认主题；</p>
<h3 id="CookieThemeResolver"><a href="#CookieThemeResolver" class="headerlink" title="CookieThemeResolver"></a>CookieThemeResolver</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieThemeResolver</span> <span class="keyword">extends</span> <span class="title">CookieGenerator</span> <span class="keyword">implements</span> <span class="title">ThemeResolver</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 省略部分代码</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">resolveThemeName</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//检查当前请求对象中是否存在主题名称，如果不存在则继续后面的操作。</span></span><br><span class="line">		String themeName = (String) request.getAttribute(THEME_REQUEST_ATTRIBUTE_NAME);</span><br><span class="line">		<span class="keyword">if</span> (themeName != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> themeName;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//在当前的请求体中获取Cookie信息中存储的主题名称值来动态的设置主题</span></span><br><span class="line">		Cookie cookie = WebUtils.getCookie(request, getCookieName());</span><br><span class="line">		<span class="keyword">if</span> (cookie != <span class="keyword">null</span>) &#123;</span><br><span class="line">			String value = cookie.getValue();</span><br><span class="line">			<span class="keyword">if</span> (StringUtils.hasText(value)) &#123;</span><br><span class="line">				themeName = value;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 获取默认的主题信息</span></span><br><span class="line">		<span class="keyword">if</span> (themeName == <span class="keyword">null</span>) &#123;</span><br><span class="line">			themeName = getDefaultThemeName();</span><br><span class="line">		&#125;</span><br><span class="line">		request.setAttribute(THEME_REQUEST_ATTRIBUTE_NAME, themeName);</span><br><span class="line">		<span class="keyword">return</span> themeName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setThemeName</span><span class="params">(HttpServletRequest request, HttpServletResponse response, String themeName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (StringUtils.hasText(themeName)) &#123;</span><br><span class="line">			<span class="comment">// 在当前请求体重设置主题名称，同时在Cookie中将对应的值存储到客户端</span></span><br><span class="line">			request.setAttribute(THEME_REQUEST_ATTRIBUTE_NAME, themeName);</span><br><span class="line">			addCookie(response, themeName);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//获取默认的主题信息设置到当前请求对象中，同时移除响应对象中Cookie值</span></span><br><span class="line">			request.setAttribute(THEME_REQUEST_ATTRIBUTE_NAME, getDefaultThemeName());</span><br><span class="line">			removeCookie(response);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过分析源码我们可以理解CookieThemeResolver的工作原理主要是使用了Cookie的工作方式进行动态的切换当前请求的Web网站系统的主题；</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">"themeResolver"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.web.servlet.theme.SessionThemeResolver"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>如果在我们的SpringMVC配置文件中不设置主题解析器，则系统默认主题为FixedThemeResolver；</p>
<p>More info: <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html" target="_blank" rel="noopener">Spring MVC</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/03/22/SpringMVC%E7%BB%84%E4%BB%B6%E4%B9%8BLocaleResolver/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/apple-touch-icon-next.png">
      <meta itemprop="name" content="maxsoft">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxSoft">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2014/03/22/SpringMVC%E7%BB%84%E4%BB%B6%E4%B9%8BLocaleResolver/" class="post-title-link" itemprop="url">SpringMVC组件之LocaleResolver—Spring系列学习笔记</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表时间</span>

              <time title="创建时间：2014-03-22 19:42:21" itemprop="dateCreated datePublished" datetime="2014-03-22T19:42:21+08:00">2014-03-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E7%B3%BB%E5%88%97/" itemprop="url" rel="index">
                    <span itemprop="name">Spring系列</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="SpringMVC组件之LocaleResolver"><a href="#SpringMVC组件之LocaleResolver" class="headerlink" title="SpringMVC组件之LocaleResolver"></a>SpringMVC组件之LocaleResolver</h2><p>LocaleResolver是SpringMVC中提供的对国际化语言的支持的组件，也就是我们经常说的多语化，通过这个组件我们可以使系统运行指定语言的Web页面。</p>
<p>该组件在Web容器中初始化的过程和MultipartResolver类似，我们这里就不再赘述。</p>
<h3 id="LocaleResolver的功能分析"><a href="#LocaleResolver的功能分析" class="headerlink" title="LocaleResolver的功能分析"></a>LocaleResolver的功能分析</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line">	<span class="function">Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上述源码我们可以看到其接口的功能只有俩个：<br>    1&gt; setLocale()一个是设置国际化语言；<br>    2&gt; resolveLocale()一个解析国际化语言；</p>
<p>以下是直接实现该接口的子类，总共有3个实现类，分别如下：</p>
<pre><code>1&gt; org.springframework.web.servlet.i18n.AbstractLocaleResolver
2&gt; org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver
3&gt; org.springframework.web.servlet.i18n.CookieLocaleResolver</code></pre><p>其中AcceptHeaderLocaleResolver是SpringMVC中默认的多语解析器</p>
<h4 id="AbstractLocaleResolver"><a href="#AbstractLocaleResolver" class="headerlink" title="AbstractLocaleResolver"></a>AbstractLocaleResolver</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Locale defaultLocale;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDefaultLocale</span><span class="params">(Locale defaultLocale)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> Locale <span class="title">getDefaultLocale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.defaultLocale;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们通过源码看到AbstractLocaleResolver是一个抽象实现类，其中只是定义了一个国际化语言的对象以备后面的子类公用。<br>具体是实现子类有俩个：<br>    1&gt; org.springframework.web.servlet.i18n.FixedLocaleResolver<br>    2&gt; org.springframework.web.servlet.i18n.SessionLocaleResolver</p>
<h5 id="FixedLocaleResolver"><a href="#FixedLocaleResolver" class="headerlink" title="FixedLocaleResolver"></a>FixedLocaleResolver</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FixedLocaleResolver</span> <span class="keyword">extends</span> <span class="title">AbstractLocaleResolver</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">FixedLocaleResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">FixedLocaleResolver</span><span class="params">(Locale locale)</span> </span>&#123;</span><br><span class="line">		setDefaultLocale(locale);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		Locale locale = getDefaultLocale();</span><br><span class="line">		<span class="keyword">if</span> (locale == <span class="keyword">null</span>) &#123;</span><br><span class="line">			locale = Locale.getDefault();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> locale;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(</span><br><span class="line">				<span class="string">"Cannot change fixed locale - use a different locale resolution strategy"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过具体的实现逻辑我们可以理解其是设置默认的国际化语言，并不支持多语的设置过程，其作用不是太大。</p>
<h5 id="SessionLocaleResolver"><a href="#SessionLocaleResolver" class="headerlink" title="SessionLocaleResolver"></a>SessionLocaleResolver</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionLocaleResolver</span> <span class="keyword">extends</span> <span class="title">AbstractLocaleResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	public static final String LOCALE_SESSION_ATTRIBUTE_NAME = SessionLocaleResolver.class.getName() + ".LOCALE";</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		Locale locale = (Locale) WebUtils.getSessionAttribute(request, LOCALE_SESSION_ATTRIBUTE_NAME);</span><br><span class="line">		<span class="keyword">if</span> (locale == <span class="keyword">null</span>) &#123;</span><br><span class="line">			locale = determineDefaultLocale(request);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> locale;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> Locale <span class="title">determineDefaultLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		Locale defaultLocale = getDefaultLocale();</span><br><span class="line">		<span class="keyword">if</span> (defaultLocale == <span class="keyword">null</span>) &#123;</span><br><span class="line">			defaultLocale = request.getLocale();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> defaultLocale;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> </span>&#123;</span><br><span class="line">		WebUtils.setSessionAttribute(request, LOCALE_SESSION_ATTRIBUTE_NAME, locale);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过以上源码分析我们可以理解SessionLocaleResolver是通过在session中动态的设置语言类别来指定系统的运行语言。也就是当我们不同语种的用户在浏览支持国际化语言的同一个网站系统，多都是通过多语切换按钮 「<font color=red>主要功能就是请求系统在当前用户的Session中设置多语语种</font>」来实现我们不同语种的用户需求。当然，这种方式的一个弊端就是如果当前用户长时间没有访问系统的话，则session的超时处理会清空当前的多语类别，再次访问需要重新设置。</p>
<h4 id="AcceptHeaderLocaleResolver"><a href="#AcceptHeaderLocaleResolver" class="headerlink" title="AcceptHeaderLocaleResolver"></a>AcceptHeaderLocaleResolver</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcceptHeaderLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> request.getLocale();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Cannot change HTTP accept header - use a different locale resolution strategy"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过以上源码分析我们可以看到其只能通过客户端的语言环境来改变Web网站系统的显示语言，这种方式使用的过程对用户而言相对比较人性化「<font color=red>因为当我们浏览器访问请求头部Accept-Language为空时，就显示Web网站系统默认的语种了，这个时候对于不熟悉计算机的用户就显得有点蹩脚了</font>」，不需要其他过多的设置就可以浏览自己语种的需求的页面。</p>
<h4 id="CookieLocaleResolver"><a href="#CookieLocaleResolver" class="headerlink" title="CookieLocaleResolver"></a>CookieLocaleResolver</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieLocaleResolver</span> <span class="keyword">extends</span> <span class="title">CookieGenerator</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	public static final String LOCALE_REQUEST_ATTRIBUTE_NAME = CookieLocaleResolver.class.getName() + ".LOCALE";</span><br><span class="line"></span><br><span class="line">	public static final String DEFAULT_COOKIE_NAME = CookieLocaleResolver.class.getName() + ".LOCALE";</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Locale defaultLocale;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CookieLocaleResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		setCookieName(DEFAULT_COOKIE_NAME);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDefaultLocale</span><span class="params">(Locale defaultLocale)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> Locale <span class="title">getDefaultLocale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.defaultLocale;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//检查请求对象是否有设置多语</span></span><br><span class="line">		Locale locale = (Locale) request.getAttribute(LOCALE_REQUEST_ATTRIBUTE_NAME);</span><br><span class="line">		<span class="keyword">if</span> (locale != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> locale;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//解析Cookie数据并获取多语信息</span></span><br><span class="line">		Cookie cookie = WebUtils.getCookie(request, getCookieName());</span><br><span class="line">		<span class="keyword">if</span> (cookie != <span class="keyword">null</span>) &#123;</span><br><span class="line">			locale = StringUtils.parseLocaleString(cookie.getValue());</span><br><span class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">				logger.debug(<span class="string">"Parsed cookie value ["</span> + cookie.getValue() + <span class="string">"] into locale '"</span> + locale + <span class="string">"'"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (locale != <span class="keyword">null</span>) &#123;</span><br><span class="line">				request.setAttribute(LOCALE_REQUEST_ATTRIBUTE_NAME, locale);</span><br><span class="line">				<span class="keyword">return</span> locale;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> determineDefaultLocale(request);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (locale != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">// 设置请求多语属性值并在Cookie中增加相对应的信息</span></span><br><span class="line">			request.setAttribute(LOCALE_REQUEST_ATTRIBUTE_NAME, locale);</span><br><span class="line">			addCookie(response, locale.toString());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// 设置默认的多语属性值并清除Cookie中的信息</span></span><br><span class="line">			request.setAttribute(LOCALE_REQUEST_ATTRIBUTE_NAME, determineDefaultLocale(request));</span><br><span class="line">			removeCookie(response);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> Locale <span class="title">determineDefaultLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		Locale defaultLocale = getDefaultLocale();</span><br><span class="line">		<span class="keyword">if</span> (defaultLocale == <span class="keyword">null</span>) &#123;</span><br><span class="line">			defaultLocale = request.getLocale();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> defaultLocale;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过以上源码分析我们可以理解CookieLocaleResolver的方式是从我们请求对象中的Cookie信息来设置多语信息，这种方式类似于SessionLocaleResolver的方式，唯一的区别那就是「<font color=red>用户只要第一次访问时设置了多语，以后再请求该Web网站系统，就会一直是第一次设置的语种，除非把本地存储的对应的该站点的Cookie清除掉或过期后才需要重新设置</font>」</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"localeResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.i18n.SessionLocaleResolver"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果我们在SpringMVC的配置文件中不注入localeResolver的值，则默认使用AcceptHeaderLocaleResolver解析器。</p>
<p>More info: <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html" target="_blank" rel="noopener">Spring MVC</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/03/20/SpringMVC%E7%BB%84%E4%BB%B6%E4%B9%8BMultipartResolver/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/apple-touch-icon-next.png">
      <meta itemprop="name" content="maxsoft">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxSoft">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2014/03/20/SpringMVC%E7%BB%84%E4%BB%B6%E4%B9%8BMultipartResolver/" class="post-title-link" itemprop="url">SpringMVC组件之MultipartResolver—Spring系列学习笔记</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表时间</span>

              <time title="创建时间：2014-03-20 17:02:19" itemprop="dateCreated datePublished" datetime="2014-03-20T17:02:19+08:00">2014-03-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E7%B3%BB%E5%88%97/" itemprop="url" rel="index">
                    <span itemprop="name">Spring系列</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="SpringMVC组件之MultipartResolver"><a href="#SpringMVC组件之MultipartResolver" class="headerlink" title="SpringMVC组件之MultipartResolver"></a>SpringMVC组件之MultipartResolver</h2><p>MultipartResolver是一个文件上传相关的解析器，当我们的Web容器启动的时候SpringMVC的会在DispatchServlet中先初始化这个解析器（整个生命周期只初始化一次），初始化源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 省略部分代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MULTIPART_RESOLVER_BEAN_NAME = <span class="string">"multipartResolver"</span>;</span><br><span class="line"><span class="keyword">private</span> MultipartResolver multipartResolver;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initMultipartResolver</span><span class="params">(ApplicationContext context)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 这里是在容器中来获取MultipartResolver的实例</span></span><br><span class="line">		<span class="keyword">this</span>.multipartResolver = context.getBean(MULTIPART_RESOLVER_BEAN_NAME, MultipartResolver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		<span class="comment">// 省略部分代码</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">		<span class="keyword">this</span>.multipartResolver = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 省略部分代码</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 省略部分代码</span></span><br></pre></td></tr></table></figure>
<p>通过以上源码我们看到在DispatchServlet中的初始化过程。<br>当我们每次对Web容器发起满足SpringMVC的映射地址规则的时候，都会在DispatchServlet中进行文件上传解析的检查，过程代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	<span class="comment">// 省略其他代码</span></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		processedRequest = checkMultipart(request);</span><br><span class="line">		multipartRequestParsed = processedRequest != request;</span><br><span class="line">	<span class="comment">// 省略其他代码</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">// 省略部分代码</span></span><br><span class="line">		<span class="keyword">if</span> (multipartRequestParsed) &#123;</span><br><span class="line">			<span class="comment">//清除文件上传相关的临时资源</span></span><br><span class="line">			cleanupMultipart(processedRequest);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//这个是整个文件上传的检查方法</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> HttpServletRequest <span class="title">checkMultipart</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> MultipartException </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.multipartResolver != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.multipartResolver.isMultipart(request)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (request <span class="keyword">instanceof</span> MultipartHttpServletRequest) &#123;</span><br><span class="line">			logger.debug(<span class="string">"Request is already a MultipartHttpServletRequest - if not in a forward, "</span> +</span><br><span class="line">					<span class="string">"this typically results from an additional MultipartFilter in web.xml"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>.multipartResolver.resolveMultipart(request);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// If not returned before: return original request.</span></span><br><span class="line">	<span class="keyword">return</span> request;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这个是文件上传后清除相关的临时资源</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">cleanupMultipart</span><span class="params">(HttpServletRequest servletRequest)</span> </span>&#123;</span><br><span class="line">	MultipartHttpServletRequest req = WebUtils.getNativeRequest(servletRequest, MultipartHttpServletRequest<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">	<span class="keyword">if</span> (req != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">this</span>.multipartResolver.cleanupMultipart(req);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上就是MultipartResolver在DispatchServlet中的使用过程，接下来我们一起看MultipartResolver的真面目，&gt;&amp;&lt;……</p>
<h3 id="MultipartResolver的功能分析"><a href="#MultipartResolver的功能分析" class="headerlink" title="MultipartResolver的功能分析"></a>MultipartResolver的功能分析</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MultipartResolver</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isMultipart</span><span class="params">(HttpServletRequest request)</span></span>;</span><br><span class="line">	<span class="function">MultipartHttpServletRequest <span class="title">resolveMultipart</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> MultipartException</span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">cleanupMultipart</span><span class="params">(MultipartHttpServletRequest request)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们通过源码可以看到MultipartResolver是一个接口，其中提供了三个方法供子类来实现。</p>
<ol>
<li>isMultipart(…)是用来检查我们当前的请求是否是MultipartHttpServletRequest</li>
<li>resolveMultipart(…)就是最核心的方法，及解析器。</li>
<li>cleanupMultipart(…)就是清除文件上传相关的临时资源。</li>
</ol>
<p>通过开发环境我们可以看到具体实现了MultipartResolver接口的类有如下几个类：</p>
<h4 id="CommonsMultipartResolver"><a href="#CommonsMultipartResolver" class="headerlink" title="CommonsMultipartResolver"></a>CommonsMultipartResolver</h4><h5 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonsMultipartResolver</span> <span class="keyword">extends</span> <span class="title">CommonsFileUploadSupport</span> <span class="keyword">implements</span> <span class="title">MultipartResolver</span>, <span class="title">ServletContextAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> resolveLazily = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CommonsMultipartResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CommonsMultipartResolver</span><span class="params">(ServletContext servletContext)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>();</span><br><span class="line">		setServletContext(servletContext);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setResolveLazily</span><span class="params">(<span class="keyword">boolean</span> resolveLazily)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.resolveLazily = resolveLazily;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> FileUpload <span class="title">newFileUpload</span><span class="params">(FileItemFactory fileItemFactory)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ServletFileUpload(fileItemFactory);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setServletContext</span><span class="params">(ServletContext servletContext)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!isUploadTempDirSpecified()) &#123;</span><br><span class="line">			getFileItemFactory().setRepository(WebUtils.getTempDir(servletContext));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMultipart</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (request != <span class="keyword">null</span> &amp;&amp; ServletFileUpload.isMultipartContent(request));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> MultipartHttpServletRequest <span class="title">resolveMultipart</span><span class="params">(<span class="keyword">final</span> HttpServletRequest request)</span> <span class="keyword">throws</span> MultipartException </span>&#123;</span><br><span class="line">		Assert.notNull(request, <span class="string">"Request must not be null"</span>);</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.resolveLazily) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> DefaultMultipartHttpServletRequest(request) &#123;</span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initializeMultipart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">					MultipartParsingResult parsingResult = parseRequest(request);</span><br><span class="line">					setMultipartFiles(parsingResult.getMultipartFiles());</span><br><span class="line">					setMultipartParameters(parsingResult.getMultipartParameters());</span><br><span class="line">					setMultipartParameterContentTypes(parsingResult.getMultipartParameterContentTypes());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			MultipartParsingResult parsingResult = parseRequest(request);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> DefaultMultipartHttpServletRequest(request, parsingResult.getMultipartFiles(),</span><br><span class="line">					parsingResult.getMultipartParameters(), parsingResult.getMultipartParameterContentTypes());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> MultipartParsingResult <span class="title">parseRequest</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> MultipartException </span>&#123;</span><br><span class="line">		String encoding = determineEncoding(request);</span><br><span class="line">		FileUpload fileUpload = prepareFileUpload(encoding);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			List&lt;FileItem&gt; fileItems = ((ServletFileUpload) fileUpload).parseRequest(request);</span><br><span class="line">			<span class="keyword">return</span> parseFileItems(fileItems, encoding);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (FileUploadBase.SizeLimitExceededException ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MaxUploadSizeExceededException(fileUpload.getSizeMax(), ex);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (FileUploadException ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MultipartException(<span class="string">"Could not parse multipart servlet request"</span>, ex);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> String <span class="title">determineEncoding</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		String encoding = request.getCharacterEncoding();</span><br><span class="line">		<span class="keyword">if</span> (encoding == <span class="keyword">null</span>) &#123;</span><br><span class="line">			encoding = getDefaultEncoding();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> encoding;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cleanupMultipart</span><span class="params">(MultipartHttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (request != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				cleanupFileItems(request.getMultiFileMap());</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">				logger.warn(<span class="string">"Failed to perform multipart cleanup for servlet request"</span>, ex);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上述的源码分析在使用CommonsMultipartResolver解析器的时候是需要其他的jar包的支持（commons-fileupload.jar 和 common-io.jar）;</p>
<h5 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 定义文件上传解析器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设定默认编码 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设定文件上传的最大值为2MB，2*1024*1024 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"2097152"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设定文件上传时写入内存的最大值，如果小于这个参数不会生成临时文件，默认为10240 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxInMemorySize"</span> <span class="attr">value</span>=<span class="string">"10240"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置上传文件的临时路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"uploadTempDir"</span> <span class="attr">value</span>=<span class="string">"fileUpload/maxsoft-temp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 是否延迟文件解析 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"resolveLazily"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="表单的代码"><a href="#表单的代码" class="headerlink" title="表单的代码"></a>表单的代码</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">"maxsoft/upload"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">     &lt;input type=<span class="string">"maxsoft_file"</span> name=<span class="string">"maxsoft_file"</span>&gt;</span><br><span class="line">     &lt;input type=<span class="string">"submit"</span> value=<span class="string">"提交"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p>注意：在上传文件的表单中一定要设置表单类型 enctype=”multipart/form-data”，否则服务器不会执行文件上传逻辑。</p>
<h5 id="服务端逻辑"><a href="#服务端逻辑" class="headerlink" title="服务端逻辑"></a>服务端逻辑</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">HttpServletRequest request;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">HttpSession session;</span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/upload"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">upload</span><span class="params">(@RequestParam(value = <span class="string">"maxsoft_file"</span>, required = <span class="keyword">false</span>)</span> MultipartFile maxsoft_file) </span>&#123;</span><br><span class="line">    <span class="comment">// 非空校验</span></span><br><span class="line">    <span class="keyword">if</span>(!maxsoft_file.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// 定义文件路径</span></span><br><span class="line">        String path = request.getServletContext().getRealPath(<span class="string">"/"</span>);</span><br><span class="line">        <span class="comment">// 定义文件名称</span></span><br><span class="line">        String name = String.valueOf(<span class="keyword">new</span> Date().getTime()+<span class="string">"_"</span> + maxsoft_file.getOriginalFilename());</span><br><span class="line">        File destFile = <span class="keyword">new</span> File(path,name);</span><br><span class="line">        <span class="comment">// 存储文件文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            maxsoft_file.transferTo(destFile);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalStateException | IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;        </span><br><span class="line">    ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">    mv.setViewName(<span class="string">"maxsoft/main"</span>);</span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="StandardServletMultipartResolver"><a href="#StandardServletMultipartResolver" class="headerlink" title="StandardServletMultipartResolver"></a>StandardServletMultipartResolver</h4><h5 id="源码分析-1"><a href="#源码分析-1" class="headerlink" title="源码分析"></a>源码分析</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StandardServletMultipartResolver</span> <span class="keyword">implements</span> <span class="title">MultipartResolver</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMultipart</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 检查请求对象的方法类型</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="string">"post"</span>.equals(request.getMethod().toLowerCase())) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		String contentType = request.getContentType();</span><br><span class="line">		<span class="keyword">return</span> (contentType != <span class="keyword">null</span> &amp;&amp; contentType.toLowerCase().startsWith(<span class="string">"multipart/"</span>));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> MultipartHttpServletRequest <span class="title">resolveMultipart</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> MultipartException </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> StandardMultipartHttpServletRequest(request);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cleanupMultipart</span><span class="params">(MultipartHttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> (Part part : request.getParts()) &#123;</span><br><span class="line">				<span class="keyword">if</span> (request.getFile(part.getName()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">					part.delete();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">			LogFactory.getLog(getClass()).warn(<span class="string">"Failed to perform cleanup of multipart items"</span>, ex);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过以上源码分析可以看出在StandardServletMultipartResolver解析器中不需要任何其他的jar包，只要容器的Servlet版本为高版本（3.0+）的ServletAPI即可运行，笔者使用了Tomcat7.0。</p>
<h5 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h5><p>首先我们在Spring容器中将该解析器注入其中，过程如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.support.StandardServletMultipartResolver"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>web.xml上传文件属性属性配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">multipart-config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 存储文件的临时目录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">location</span>&gt;</span>d:/<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 文件大小限制2MB --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">max-file-size</span>&gt;</span>2097152<span class="tag">&lt;/<span class="name">max-file-size</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 上传文件整个请求对象大小限制 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">max-request-size</span>&gt;</span>4194304<span class="tag">&lt;/<span class="name">max-request-size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">multipart-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="表单代码-amp-服务端逻辑"><a href="#表单代码-amp-服务端逻辑" class="headerlink" title="表单代码 &amp; 服务端逻辑"></a>表单代码 &amp; 服务端逻辑</h5><p>表单代码和服务端逻辑基本和第一模一样，这里就不在赘述了。<br>在服务端接收文件的时候可以使用 MultipartHttpServletRequest , 也可以使用 MultipartFile，<br>当使用我们MultipartHttpServletRequest来接收文件数据时，只要在服务器获取这个对象的实例，通过其getFile(‘表单文件名’)或getFiles(‘表单文件名’),获取即可。<br>以下是解析文件的最核心的代码，器使用 servlet3.0 的 request.getParts() 方法获取上传文件，并将其封装到 MultipartFile 对象中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StandardMultipartHttpServletRequest</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> MultipartException </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>(request);</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		Collection&lt;Part&gt; parts = request.getParts();</span><br><span class="line">		MultiValueMap&lt;String, MultipartFile&gt; files = <span class="keyword">new</span> LinkedMultiValueMap&lt;String, MultipartFile&gt;(parts.size());</span><br><span class="line">		<span class="keyword">for</span> (Part part : parts) &#123;</span><br><span class="line">			String filename = extractFilename(part.getHeader(CONTENT_DISPOSITION));</span><br><span class="line">			<span class="keyword">if</span> (filename != <span class="keyword">null</span>) &#123;</span><br><span class="line">				files.add(part.getName(), <span class="keyword">new</span> StandardMultipartFile(part, filename));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		setMultipartFiles(files);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> MultipartException(<span class="string">"Could not parse multipart servlet request"</span>, ex);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="相关源码"><a href="#相关源码" class="headerlink" title="相关源码"></a>相关源码</h5><h6 id="MultipartHttpServletRequest"><a href="#MultipartHttpServletRequest" class="headerlink" title="MultipartHttpServletRequest"></a>MultipartHttpServletRequest</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MultipartHttpServletRequest</span> <span class="keyword">extends</span> <span class="title">HttpServletRequest</span>, <span class="title">MultipartRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">HttpMethod <span class="title">getRequestMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">HttpHeaders <span class="title">getRequestHeaders</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">HttpHeaders <span class="title">getMultipartHeaders</span><span class="params">(String paramOrFileName)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="MultipartRequest"><a href="#MultipartRequest" class="headerlink" title="MultipartRequest"></a>MultipartRequest</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MultipartRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">Iterator&lt;String&gt; <span class="title">getFileNames</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">MultipartFile <span class="title">getFile</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">List&lt;MultipartFile&gt; <span class="title">getFiles</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">Map&lt;String, MultipartFile&gt; <span class="title">getFileMap</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">MultiValueMap&lt;String, MultipartFile&gt; <span class="title">getMultiFileMap</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">String <span class="title">getMultipartContentType</span><span class="params">(String paramOrFileName)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>#####</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StandardMultipartHttpServletRequest</span> <span class="keyword">extends</span> <span class="title">AbstractMultipartHttpServletRequest</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONTENT_DISPOSITION = <span class="string">"content-disposition"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILENAME_KEY = <span class="string">"filename="</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StandardMultipartHttpServletRequest</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> MultipartException </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(request);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Collection&lt;Part&gt; parts = request.getParts();</span><br><span class="line">			MultiValueMap&lt;String, MultipartFile&gt; files = <span class="keyword">new</span> LinkedMultiValueMap&lt;String, MultipartFile&gt;(parts.size());</span><br><span class="line">			<span class="keyword">for</span> (Part part : parts) &#123;</span><br><span class="line">				String filename = extractFilename(part.getHeader(CONTENT_DISPOSITION));</span><br><span class="line">				<span class="keyword">if</span> (filename != <span class="keyword">null</span>) &#123;</span><br><span class="line">					files.add(part.getName(), <span class="keyword">new</span> StandardMultipartFile(part, filename));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			setMultipartFiles(files);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MultipartException(<span class="string">"Could not parse multipart servlet request"</span>, ex);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> String <span class="title">extractFilename</span><span class="params">(String contentDisposition)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (contentDisposition == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// <span class="doctag">TODO:</span> can only handle the typical case at the moment</span></span><br><span class="line">		<span class="keyword">int</span> startIndex = contentDisposition.indexOf(FILENAME_KEY);</span><br><span class="line">		<span class="keyword">if</span> (startIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		String filename = contentDisposition.substring(startIndex + FILENAME_KEY.length());</span><br><span class="line">		<span class="keyword">if</span> (filename.startsWith(<span class="string">"\""</span>)) &#123;</span><br><span class="line">			<span class="keyword">int</span> endIndex = filename.indexOf(<span class="string">"\""</span>, <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">if</span> (endIndex != -<span class="number">1</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> filename.substring(<span class="number">1</span>, endIndex);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> endIndex = filename.indexOf(<span class="string">";"</span>);</span><br><span class="line">			<span class="keyword">if</span> (endIndex != -<span class="number">1</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> filename.substring(<span class="number">0</span>, endIndex);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> filename;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getMultipartContentType</span><span class="params">(String paramOrFileName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Part part = getPart(paramOrFileName);</span><br><span class="line">			<span class="keyword">return</span> (part != <span class="keyword">null</span> ? part.getContentType() : <span class="keyword">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MultipartException(<span class="string">"Could not access multipart servlet request"</span>, ex);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> HttpHeaders <span class="title">getMultipartHeaders</span><span class="params">(String paramOrFileName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Part part = getPart(paramOrFileName);</span><br><span class="line">			<span class="keyword">if</span> (part != <span class="keyword">null</span>) &#123;</span><br><span class="line">				HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">				<span class="keyword">for</span> (String headerName : part.getHeaderNames()) &#123;</span><br><span class="line">					headers.put(headerName, <span class="keyword">new</span> ArrayList&lt;String&gt;(part.getHeaders(headerName)));</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> headers;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MultipartException(<span class="string">"Could not access multipart servlet request"</span>, ex);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StandardMultipartFile</span> <span class="keyword">implements</span> <span class="title">MultipartFile</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 省略部分代码</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html" target="_blank" rel="noopener">Spring MVC</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/03/18/SpringMVC%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E6%A6%82%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/apple-touch-icon-next.png">
      <meta itemprop="name" content="maxsoft">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxSoft">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2014/03/18/SpringMVC%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E6%A6%82%E8%BF%B0/" class="post-title-link" itemprop="url">SpringMVC的工作原理概述—Spring系列学习笔记</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表时间</span>

              <time title="创建时间：2014-03-18 23:42:49" itemprop="dateCreated datePublished" datetime="2014-03-18T23:42:49+08:00">2014-03-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E7%B3%BB%E5%88%97/" itemprop="url" rel="index">
                    <span itemprop="name">Spring系列</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="SpringMVC的工作原理"><a href="#SpringMVC的工作原理" class="headerlink" title="SpringMVC的工作原理"></a>SpringMVC的工作原理</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Spring Web MVC是原始的WebFramework在Servlet API 的基础之上建立的MVC框架。当时，Spring Web MVC是被包含在了Spring Framework体系中。它的标准名称就是“Spring Web MVC”，这个名字来自于Spring体系源码模块spring-webmvc。但是它也通常被称为“Spring MVC”。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SpringMVC组件灵活多样，支持多种工作流程。</p>
<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SpringMVC也是一个请求驱动的框架，使用了前端控制器模式来设计实现。我们通过配置文件也可以理解，其核心就是一个Servlet（DispatcherServlet）。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;web-app xmlns=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span><br><span class="line">    xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"</span></span><br><span class="line"><span class="string">            http://java.sun.com/xml/ns/javaee</span></span><br><span class="line"><span class="string">            http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span></span><br><span class="line">    version=<span class="string">"3.0"</span>&gt;</span><br><span class="line">	...</span><br><span class="line">	&lt;servlet&gt;</span><br><span class="line">		&lt;servlet-name&gt;DispatcherServlet&lt;/servlet-name&gt;</span><br><span class="line">		&lt;servlet-<span class="class"><span class="keyword">class</span>&gt;<span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">servlet</span>.<span class="title">DispatcherServlet</span>&lt;/<span class="title">servlet</span>-<span class="title">class</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">init</span>-<span class="title">param</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">param</span>-<span class="title">name</span>&gt;<span class="title">contextConfigLocation</span>&lt;/<span class="title">param</span>-<span class="title">name</span>&gt;</span></span><br><span class="line">			&lt;param-value&gt;classpath:spring/spring-*.xml&lt;/param-value&gt;</span><br><span class="line">		&lt;/init-param&gt;</span><br><span class="line">		&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">	&lt;/servlet&gt;</span><br><span class="line">	&lt;servlet-mapping&gt;</span><br><span class="line">		&lt;servlet-name&gt;DispatcherServlet&lt;/servlet-name&gt;</span><br><span class="line">		&lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">	&lt;/servlet-mapping&gt;</span><br><span class="line">	...</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>
<p>在配置文件中我可以看到，客户端对Web容器发起请求，如果请求地址满足指定的地址规则，则容器就会转发到SpringMVC的前端控制器（DispatcherServlet），进行相对应的地址映射查找以及执行对应的后端控制器，业务层，数据模型等。具体过程我们可以分析以下源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title">FrameworkServlet</span> </span>&#123;</span><br><span class="line">	<span class="comment">//省略部分代码</span></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		<span class="comment">// 这里在程序初始化的时候就加载SpringMVC的相关配置文件</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			ClassPathResource resource = <span class="keyword">new</span> ClassPathResource(DEFAULT_STRATEGIES_PATH, DispatcherServlet<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">			defaultStrategies = PropertiesLoaderUtils.loadProperties(resource);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Could not load 'DispatcherServlet.properties': "</span> + ex.getMessage());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 省略部分代码</span></span><br><span class="line">	<span class="comment">// 开始初始化SpringMVC相关组件信息</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initStrategies</span><span class="params">(ApplicationContext context)</span> </span>&#123;</span><br><span class="line">		initMultipartResolver(context);  <span class="comment">// 多媒体文件解析器</span></span><br><span class="line">		initLocaleResolver(context); <span class="comment">// 多语解析器</span></span><br><span class="line">		initThemeResolver(context); <span class="comment">// 主题解析器</span></span><br><span class="line">		initHandlerMappings(context); <span class="comment">// 控制器句柄映射集合</span></span><br><span class="line">		initHandlerAdapters(context); <span class="comment">//控制器句柄适配器</span></span><br><span class="line">		initHandlerExceptionResolvers(context); <span class="comment">//句柄异常解析器</span></span><br><span class="line">		initRequestToViewNameTranslator(context); <span class="comment">//请求视图名称转换器</span></span><br><span class="line">		initViewResolvers(context); <span class="comment">//视图解析器</span></span><br><span class="line">		initFlashMapManager(context); <span class="comment">//flash映射管理器</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 省略部分代码</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 省略部分代码</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 记录请求参数快照</span></span><br><span class="line">		Map&lt;String, Object&gt; attributesSnapshot = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (WebUtils.isIncludeRequest(request)) &#123;</span><br><span class="line">			logger.debug(<span class="string">"Taking snapshot of request attributes before include"</span>);</span><br><span class="line">			attributesSnapshot = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">			Enumeration&lt;?&gt; attrNames = request.getAttributeNames();</span><br><span class="line">			<span class="keyword">while</span> (attrNames.hasMoreElements()) &#123;</span><br><span class="line">				String attrName = (String) attrNames.nextElement();</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">this</span>.cleanupAfterInclude || attrName.startsWith(<span class="string">"org.springframework.web.servlet"</span>)) &#123;</span><br><span class="line">					attributesSnapshot.put(attrName, request.getAttribute(attrName));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 开始添加框架中使用的相关Request参数对象值</span></span><br><span class="line">		request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());</span><br><span class="line">		request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, <span class="keyword">this</span>.localeResolver);</span><br><span class="line">		request.setAttribute(THEME_RESOLVER_ATTRIBUTE, <span class="keyword">this</span>.themeResolver);</span><br><span class="line">		request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource());</span><br><span class="line"></span><br><span class="line">		FlashMap inputFlashMap = <span class="keyword">this</span>.flashMapManager.retrieveAndUpdate(request, response);</span><br><span class="line">		<span class="keyword">if</span> (inputFlashMap != <span class="keyword">null</span>) &#123;</span><br><span class="line">			request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));</span><br><span class="line">		&#125;</span><br><span class="line">		request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, <span class="keyword">new</span> FlashMap());</span><br><span class="line">		request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, <span class="keyword">this</span>.flashMapManager);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//开始控制器分发</span></span><br><span class="line">			doDispatch(request, response);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//将初始的请求参数快照，重新存储到当前请求对象中</span></span><br><span class="line">			<span class="keyword">if</span> (attributesSnapshot != <span class="keyword">null</span>) &#123;</span><br><span class="line">				restoreAttributesAfterInclude(request, attributesSnapshot);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 控制器分发</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		HttpServletRequest processedRequest = request;</span><br><span class="line">		HandlerExecutionChain mappedHandler = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">boolean</span> multipartRequestParsed = <span class="keyword">false</span>;</span><br><span class="line">		<span class="comment">// 初始化异步请求管理器</span></span><br><span class="line">		WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			ModelAndView mv = <span class="keyword">null</span>;</span><br><span class="line">			Exception dispatchException = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">// 检查是否有多媒体文件上传，如果有多媒体文件上传，则进行MultipartResolver解析器的相关解析操作；</span></span><br><span class="line">				processedRequest = checkMultipart(request);</span><br><span class="line">				multipartRequestParsed = processedRequest != request;</span><br><span class="line"></span><br><span class="line">				<span class="comment">//获取当前请求的控制器句柄</span></span><br><span class="line">				mappedHandler = getHandler(processedRequest, <span class="keyword">false</span>);</span><br><span class="line">				<span class="keyword">if</span> (mappedHandler == <span class="keyword">null</span> || mappedHandler.getHandler() == <span class="keyword">null</span>) &#123;</span><br><span class="line">					noHandlerFound(processedRequest, response);</span><br><span class="line">					<span class="keyword">return</span>;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 将控制器句柄组装为通用的适配器对象</span></span><br><span class="line">				HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 省略部分代码 </span></span><br><span class="line"></span><br><span class="line">				<span class="comment">// 执行控制器相关的拦截器预处理逻辑</span></span><br><span class="line">				<span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class="line">					<span class="keyword">return</span>;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="comment">// 通过适配器执行控制器的相关逻辑,并返回模型视图</span></span><br><span class="line">					mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">finally</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">						<span class="keyword">return</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">//省略部分代码</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">				dispatchException = ex;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 处理异常、请求状态及触发请求完成事件以及视图渲染等</span></span><br><span class="line">			processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">			triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (Error err) &#123;</span><br><span class="line">			triggerAfterCompletionWithError(processedRequest, response, mappedHandler, err);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">				<span class="comment">//执行控制器的相关拦截器执行完成的逻辑</span></span><br><span class="line">				mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//清除多媒体文件上传过程中使用的相关资源</span></span><br><span class="line">			<span class="keyword">if</span> (multipartRequestParsed) &#123;</span><br><span class="line">				cleanupMultipart(processedRequest);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="运行原理图"><a href="#运行原理图" class="headerlink" title="运行原理图"></a>运行原理图</h3><p>通过以上代码分析后，下面这张图片可以更加直观的展现出SpringMVC的工作原理（网络配图）。<br><img src="/uploads/SpringMVC.jpg" /></p>
<h3 id="运行过程总结"><a href="#运行过程总结" class="headerlink" title="运行过程总结"></a>运行过程总结</h3><p>第一步：客户端向Web容器发起请求后，容器会通过配置文件检查URL是否满足SpringMVC的Url规则，如果满足则请求进入DispatchServlet控制器。</p>
<p>第二步：在DispatchServlet中首先通过请求地址查询对应的控制器；</p>
<p>第三步：通过查询到的控制器进行组装适配器，进而通过其执行控制器的相关逻辑（业务层，数据访问层）；</p>
<p>第四步：适配器执行后返回ModelAndView，</p>
<p>第五步：控制器请求视图解析器（ViewResolver）去进行视图解析，渲染等操作后将向用户响应结果</p>
<p>More info: <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html" target="_blank" rel="noopener">Spring MVC</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/03/11/JavaWeb%E4%B9%8BServlet%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%8C%E7%9B%91%E5%90%AC%E5%99%A8%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/apple-touch-icon-next.png">
      <meta itemprop="name" content="maxsoft">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxSoft">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2014/03/11/JavaWeb%E4%B9%8BServlet%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%8C%E7%9B%91%E5%90%AC%E5%99%A8%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">JavaWeb之Servlet，过滤器，监听器总结</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表时间</span>

              <time title="创建时间：2014-03-11 21:21:09" itemprop="dateCreated datePublished" datetime="2014-03-11T21:21:09+08:00">2014-03-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最近的所有独立功能模块都是基于单纯的 Servlet 技术来实现完成，并没有借助其他的第三方技术框架，所以今天有必要来总结一下这些使用的关键技术（ Servlet，Filter，Listener ），以加深记忆和理解。同时，也为今后的工作中熟练使用这些技术而夯实基础。</p>
<h2 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Java Servlet （Server Applet）是运行在 Web 服务器或应用服务器上的程序，它是作为来自 Web 浏览器或其他 HTTP 客户端的请求和 HTTP 服务器上的数据库或应用程序之间的中间层。使用 Servlet，可以收集来自网页表单的用户输入信息，以及呈现来自数据库或者其他源的记录并动态创建网页。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color=red>Java Servlet 生命周期可被定义为从创建直到销毁的整个过程</font>。如下：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1· 通过调用 init () 方法进行初始化（容器启动时执行）。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2· 通过调用 service() 方法来处理客户端的请求。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3· 通过调用 destroy() 方法终止（容器停止时执行）。<br>Java Servlet 所有的子类实现都是基于顶层 Servlet 的接口规范。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException</span>; <span class="comment">//初始化</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span></span>; <span class="comment">//获取Servlet配置信息</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException</span>; <span class="comment">//Servlet服务</span></span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span></span>; <span class="comment">//获取Servlet相关的信息</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>; <span class="comment">//Servlet销毁</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下为一个完整的 Servlet 应用实现过程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.maxsoft.summary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.getWriter().print(<span class="string">"Hello MaxSoft ! This is get method."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.getWriter().print(<span class="string">"Hello MaxSoft ! This is post method."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPut</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.getWriter().print(<span class="string">"Hello MaxSoft ! This is put method."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDelete</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.getWriter().print(<span class="string">"Hello MaxSoft ! This is delete method."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.addHeader(<span class="string">"Author-Info"</span>, <span class="string">"MaxSoft"</span>);</span><br><span class="line">		<span class="comment">//这里可以实现所有方法共同的逻辑，如编码转换，响应头的信息添加等</span></span><br><span class="line">		<span class="keyword">super</span>.service(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注册以上 Servlet （TestServlet.java）到Web容器中web.xml（Tomcat）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">web-app</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span> <span class="meta-string">"http://java.sun.com/dtd/web-app_2_3.dtd"</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">display-name</span>&gt;</span>FlexEngagementRing<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 省略其他配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>testServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.maxsoft.summary.TestServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 省略其他配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>testServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/testServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Servlet API 中提供了一个 Filter 接口，开发 Web 应用时可以借助这个接口来实现对 Web 请求的过滤操作（请求或响应），则该实现类就被称为「过滤器」。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color=red>Filter 生命周期和 Servlet 类似也被定义为从创建直到销毁的整个过程</font>。如下：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1· 通过调用 init () 方法进行初始化（容器启动时执行）。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2· 通过调用 doFilter() 方法来处理客户端的请求。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3· 通过调用 destroy() 方法终止（容器停止时执行）。<br>Filter 所有的子类实现都是基于顶层 Filter 的接口规范。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span> <span class="params">( ServletRequest request, ServletResponse response, FilterChain chain )</span> <span class="keyword">throws</span> IOException, ServletException</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下为一个完整的 Filter 应用实现过程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.maxsoft.summary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Filter destroy ！"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">		response.getWriter().println(<span class="string">"[Befor] This is Filter ...... "</span>);</span><br><span class="line">		chain.doFilter(request, response);</span><br><span class="line">		response.getWriter().println(<span class="string">"[After] This is Filter ...... "</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Filter init ！"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注册以上 Filter （TestFilter.java）到Web容器中web.xml（Tomcat）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">display-name</span>&gt;</span>FlexEngagementRing<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TestFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>test<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.maxsoft.summary.TestFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TestFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 省略其他配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>testServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.maxsoft.summary.TestServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 省略其他配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>testServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/testServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上运行效果如下：<img src="/uploads/filter_0.png" /></p>
<h2 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Servlet API 中定提供了多种类型的监听器，它们分别对 ServletContext、 HttpSession、ServletRequest 数据域对象创建销毁和内部数据状态的改变进行监听。<br/><font color=red>ServletContext 相关的监听器如下：</font><br>1· javax.servlet.ServletContextAttributeListener<br>2· javax.servlet.ServletContextListener<br/><font color=red>ServletRequest 相关的监听器如下（servlet-api-2.3中貌似没有提供这俩监听器）：</font><br>1· javax.servlet.ServletRequestAttributeListener.class<br>2· javax.servlet.ServletRequestListener.class<br/><font color=red>HttpSession 相关的监听器如下：</font><br>1· javax.servlet.http.HttpSessionActivationListener<br>2· javax.servlet.http.HttpSessionAttributeListener<br>3· javax.servlet.http.HttpSessionBindingListener<br>4· javax.servlet.http.HttpSessionListener<br>以上监听器都是基于 JDK 中提供的 EventListener 接口规范而进行个差异化实现。<br>它们大致可以分为三种类型的事件：<br>1· 数据域对象创建和销毁的事件监听器<br>2· 数据域对象的相关属性变更事件监听器<br>3· 绑定到Session中数据对象本身状态变更的事件监听器<br><font color=red>Listener 生命周期伴随着Web容器的整个生命过程</font>。<br>EventListener 接口规范如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.util;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EventListener</span> </span>&#123;</span><br><span class="line">	<span class="comment">//TODO</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当我们在 Web 开发过程中需要哪种类型的监听器只要实现其对应的接口即可进行相对应的事件逻辑处理。我们现在以 HttpSession 的初始化与销毁为例进行监听器的实现，代码逻辑如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.maxsoft.summary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.maxsoft.session.listener.SessionConstant;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestHttpSessionListener</span> <span class="keyword">implements</span> <span class="title">HttpSessionListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent event)</span> </span>&#123;</span><br><span class="line">    	<span class="comment">//Session创建时执行的事件逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent event)</span> </span>&#123;</span><br><span class="line">    	<span class="comment">//Session销毁时执行的事件逻辑</span></span><br><span class="line">    	HttpSession session = event.getSession();</span><br><span class="line">		Object user = session.getAttribute(SessionConstant.USER_VO);</span><br><span class="line">		Object userName = session.getAttribute(SessionConstant.USER_NAME);</span><br><span class="line">		Object userCode = session.getAttribute(SessionConstant.USER_CODE);</span><br><span class="line">		System.out.println( <span class="string">"User:"</span> + user + <span class="string">"  Name:"</span> + userName + <span class="string">"  Code:"</span> + userCode);</span><br><span class="line">		ServletContext context = session.getServletContext();</span><br><span class="line">		String user_uuid = (String)session.getAttribute(SessionConstant.USER_UUID);</span><br><span class="line">		context.removeAttribute(user_uuid);</span><br><span class="line">		</span><br><span class="line">		System.out.print(<span class="string">"Session登录信息超时销毁。。。。。。"</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.print(<span class="string">"这里也可以通过数据库进行数据持久操作。。。。。。"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注册以上监听器到Web容器中web.xml ( Tomcat )：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">display-name</span>&gt;</span>FlexEngagementRing<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TestFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>test<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.maxsoft.summary.TestFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TestFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span> </span><br><span class="line">  	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.maxsoft.summary.TestHttpSessionListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 省略其他配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>testServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.maxsoft.summary.TestServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 省略其他配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>testServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/testServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>10<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上示例的运行结果为，如果用户登录系统后进行退出系统时或者Session达到了系统的超时时间，则会触发Session销毁的事件，进而执行事件体中相关的代码逻辑。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在Web容器中它们三者的启动顺序大致为：Listener → Filter → Servlet；我们在开发 Web 应用程序时，可以通过不同的使用场景进行选择使用。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/03/09/JavaWeb%E5%85%B3%E4%BA%8E%E9%80%80%E5%87%BA%E7%B3%BB%E7%BB%9F%E6%97%B6%E7%9A%84%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/apple-touch-icon-next.png">
      <meta itemprop="name" content="maxsoft">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxSoft">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2014/03/09/JavaWeb%E5%85%B3%E4%BA%8E%E9%80%80%E5%87%BA%E7%B3%BB%E7%BB%9F%E6%97%B6%E7%9A%84%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">JavaWeb关于退出系统时的日志记录</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表时间</span>

              <time title="创建时间：2014-03-09 19:51:32" itemprop="dateCreated datePublished" datetime="2014-03-09T19:51:32+08:00">2014-03-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通过这俩周的时间，终于把相关的独立模块功能都悉数完成了，接下来的工作就是和第三方框架（ Spring ， Struts2.0，Hibernate  ）来进行集成开发了。在前天和教导老师沟通后，又新增了几个相对较小，但是比较适用的新功能。分别有「登录退出日志记录」,「是否已登录的校验并剔除登录功能」,「防重复提交功能」。<br>由于「防重复提交功能」需要用到Spring中相关的拦截器功能需要集成开发时进行记录总结，而「登录退出日志记录」,「是否已登录的校验并剔除登录功能」可以通过重写 Session 销毁事件进行统一处理，所以今天就统一介绍关于「登录退出日志记录」,「是否已登录的校验并剔除登录功能」的实现过程。「防重复提交功能」放到后面的集成开发中来做详细的记录总结。</p>
<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;首先登录日志记录可以通过登录事件后添加相关的日志记录逻辑进行登录日志的记录，相对比较简单，这里就不做过多的介绍了。我们主要来实现退出系统时的日志记录，退出系统主要有如下几种场景：<br>1· 登录系统后做完相关业务操作，点击退出按钮进行退出操作。<br>2· 登录系统后做完相关业务直接关闭浏览器<br>3· 登录后网络中断（边界场景）。<br/><font color=red><b>注意：</b>以上2,3 这种情况是相对不好处理，只能等到Session自动销毁后做相关日志信息记录以及其他的操作。</font><br>通过分析后我们可以得知用户不论以哪种场景做退出操作，都最终体现在了 Session 的销毁方面，所以我们为能够全面的覆盖以上这几种场景，可以直接将日志记录逻辑写入到Session销毁的方法中，进而完美的达到了我们预期的功能结果。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;接下来我们分析「是否已登录的校验并剔除登录功能」，这个功能乍一看感觉相对比较复杂，其实当我们理解了 Session ，Appalachian（ ServletContext ）的生命周期后就会变得相对容易了。<br><b style="color:red;">Session</b>：从用户发起登录请求并进入系统后到用户点击退出操作或者长时间没有操作达到了系统中设定的 Session 销毁时间，为一个生命周期。<br><b style="color:red;">Application（ServletContext）</b>：从系统启动到系统停止，为一个生命周期。<br>首先我们可以在用户登录系统后将其唯一信息（UUID等）做为键写入到 Application（ ServletContext ）中（以备登录系统后用来校验该用户是否已经登录系统），并且在 Session 销毁时将 UUID 从 Application（ ServletContext ）中移除。如果用户在A电脑登录系统后，没有做退出操作，又在B电脑进行了登陆操作，这时可以通过校验逻辑在  Application（ ServletContext ）中获取该用户的 UUID ，如果有值，则表示用户已登录系统，这时可以进行合适的提示处理。如果没有值，则可以直接登陆。</p>
<h2 id="代码逻辑"><a href="#代码逻辑" class="headerlink" title="代码逻辑"></a>代码逻辑</h2><p>1· 相关的Java大致代码逻辑如下（ SessionTimeoutListener.java ），主要实现了 HttpSessionListener ，HttpSessionAttributeListener 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.maxsoft.session.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionAttributeListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionBindingEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionTimeoutListener</span> <span class="keyword">implements</span> <span class="title">HttpSessionListener</span>, <span class="title">HttpSessionAttributeListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//Session创建是触发事件</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent event)</span> </span>&#123;</span><br><span class="line">		HttpSession session = event.getSession();</span><br><span class="line">		Object user = session.getAttribute(SessionConstant.USER_VO);</span><br><span class="line">		Object userName = session.getAttribute(SessionConstant.USER_NAME);</span><br><span class="line">		Object userCode = session.getAttribute(SessionConstant.USER_CODE);</span><br><span class="line">		</span><br><span class="line">		System.out.println( <span class="string">"User:"</span> + user + <span class="string">"  Name:"</span> + userName + <span class="string">"  Code:"</span> + userCode);</span><br><span class="line">		ServletContext context = session.getServletContext();</span><br><span class="line">		String user_uuid = (String)session.getAttribute(SessionConstant.USER_UUID);</span><br><span class="line">		context.removeAttribute(user_uuid);</span><br><span class="line">		</span><br><span class="line">		System.out.print(<span class="string">"Session登录信息超时销毁......"</span>);</span><br><span class="line">		System.out.print(<span class="string">"这里切入日志记录逻辑，进行日志信息的处理......"</span>);</span><br><span class="line">		System.out.print(<span class="string">"这里也可以进行数据持久操作......"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span><span class="params">(HttpSessionBindingEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//Session增加属性时触发事件</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span><span class="params">(HttpSessionBindingEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//Session移除属性时触发事件</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span><span class="params">(HttpSessionBindingEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//Session替换属性值时触发事件</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2· 注册监听器如下代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">display-name</span>&gt;</span>FlexEngagementRing<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 省略其他代码 --&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.maxsoft.session.listener.SessionTimeoutListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>5<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3· 校验是否已登录，如果已登录，则进行柔性提示并执行相关的操作。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.maxsoft.login;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckController</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span><span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		String jsonStr = <span class="keyword">null</span>;</span><br><span class="line">		response.setContentType(<span class="string">"application/json;charset=utf-8"</span>);<span class="comment">//指定返回的格式为JSON格式  </span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//这里可以通过用户名和密码进行查询用户，然后通过用户的UUID来进行校验。</span></span><br><span class="line">		String uuid = <span class="string">"MaxSoft_000000000000000000001"</span>;</span><br><span class="line">		<span class="comment">//这里获取内容的前提是必须要在登录成功注册 Session 后，</span></span><br><span class="line">		<span class="comment">//进行对相应的信息执行属性（req.getSession().getServletContext().setAttribute(uuid, "MaxSoft");）</span></span><br><span class="line">		String msg = (String)request.getSession().getServletContext().getAttribute(uuid);</span><br><span class="line">		<span class="keyword">if</span>(msg != <span class="keyword">null</span> &amp;&amp; msg.length() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">			jsonStr =<span class="string">"&#123;\"state\":\"true\",\"msg\":\"当前用户已登录，是否踢出？\"&#125;"</span>;  </span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			jsonStr =<span class="string">"&#123;\"state\":\"false\",\"msg\":\"\"&#125;"</span>;  </span><br><span class="line">		&#125;</span><br><span class="line">		PrintWriter out =<span class="keyword">null</span> ;  </span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			out =response.getWriter() ;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;  </span><br><span class="line">		out.write(jsonStr);  </span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们通过 Ajax 技术在登录验证通过后调用该请求，然后执行是否已经在线的验证逻辑，如果已经在线则进行柔性提示，否则直接进行 Session 注册并进入系统。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/03/06/JavaWeb%E9%A1%B9%E7%9B%AE%E7%AE%80%E5%8D%95%E7%9A%84%E7%88%AC%E8%99%AB%E6%A1%88%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/apple-touch-icon-next.png">
      <meta itemprop="name" content="maxsoft">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxSoft">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2014/03/06/JavaWeb%E9%A1%B9%E7%9B%AE%E7%AE%80%E5%8D%95%E7%9A%84%E7%88%AC%E8%99%AB%E6%A1%88%E4%BE%8B/" class="post-title-link" itemprop="url">JavaWeb项目简单的爬虫案例</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表时间</span>

              <time title="创建时间：2014-03-06 20:21:12" itemprop="dateCreated datePublished" datetime="2014-03-06T20:21:12+08:00">2014-03-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;今天继续总结关于我本次的毕设中的一个独立功能模块的设计实现过程。该功能主要使用爬虫来获取目标网站的有效数据供所属站点使用，逻辑相对比较简单。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;分析目标网站的数据结构或者页面的层级结构，来制定对应的数据获取逻辑。本次毕设主要是通过 Google Chrome 浏览器中的「开发者模式」来分析目标网站的页面层级结构以及数据结构，从而来确定获取数据的逻辑结构。</p>
<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本次案例获取的数据是金拓网站关于黄金，铂金，巴金，白银的相关实时市价。供毕设中的实时交易价格功能的数据来源。</p>
<ol>
<li>通过浏览器的开发者模式进行页面结构以及数据结构的分析（主要分析数据区域的HTML代码层级以及通过url请求的数据结构）；</li>
<li>通过分析结果来制定获取数据的逻辑结构（KitcoGoldInfoProxyService.java），代码逻辑如下：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.maxsoft.constant.Constant;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KitcoGoldInfoProxyService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String result_info;	<span class="comment">//结果信息</span></span><br><span class="line">	<span class="keyword">private</span> String[] div_id;	<span class="comment">//参数信息</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDiv_id</span><span class="params">(String[] div_id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.div_id = div_id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">crawl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; div_id.length; i++) &#123;</span><br><span class="line">				StringBuffer is = <span class="keyword">new</span> StringBuffer(Constant.ReceptionConfigurationConstant.KITCO_PRE_URL).append(div_id[i]);</span><br><span class="line">				URL myUrl = <span class="keyword">new</span> URL(is.toString());</span><br><span class="line">				is = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">				BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(myUrl.openStream()));</span><br><span class="line">				<span class="keyword">while</span> ((result_info = br.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">					is.append(result_info);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (is.indexOf(<span class="string">"height=\"24\""</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">					result_info = is.toString().replaceFirst(<span class="string">"height=\"24\""</span>,<span class="string">""</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (is.indexOf(<span class="string">"images/"</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">					result_info = result_info.replaceAll(<span class="string">"images/"</span>,<span class="string">"http://www.kitco.cn/images/"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				list.add(result_info);</span><br><span class="line">			&#125;</span><br><span class="line">			URL url = <span class="keyword">new</span> URL(<span class="string">"http://www.kitco.cn/KitcoDynamicSite/RequestHandler?requestName=getFileContent&amp;AttributeId=ShangHaiPrices"</span>);</span><br><span class="line">			StringBuffer buffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">			BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(url.openStream()));</span><br><span class="line">			<span class="keyword">while</span> ((result_info = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">				buffer.append(result_info);</span><br><span class="line">			&#125;</span><br><span class="line">			list.add(buffer.toString().replace(<span class="string">" width=\"568\""</span>, <span class="string">""</span>).replace(<span class="string">"&lt;table border=\"0\" cellspacing=\"0\" cellpadding=\"0\"&gt;"</span>,<span class="string">"&lt;table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"&gt;&lt;tr&gt;&lt;td class=\"fcolor_gray\" colspan=\"9\" align=\"center\" style=\"background-color:#e3effb; \"&gt;上海黄金交易所行情&lt;/td&gt;&lt;/tr&gt;"</span>));</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>编写 Servlet 代码供前端通过 Ajax 来请求数据（KitcoGoldInfoProxyServlet.java, InternationaleGoldPrice.java），代码如下：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KitcoGoldInfoProxyServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="keyword">private</span> KitcoGoldInfoProxyService service = <span class="keyword">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		service = <span class="keyword">new</span> KitcoGoldInfoProxyService();</span><br><span class="line">		service.setDiv_id(<span class="keyword">new</span> String[]&#123;<span class="string">"PreciousMetalsSpotPricesCNY"</span>, <span class="string">"PreciousMetalsSpotPrices"</span>&#125;);</span><br><span class="line">		List&lt;String&gt; list = service.crawl();</span><br><span class="line">		Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">		String json = gson.toJson(list);</span><br><span class="line">		response.setHeader(<span class="string">"content-type"</span>, <span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">		response.getWriter().print(json);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InternationaleGoldPrice</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		req.getRequestDispatcher(<span class="string">"internationalegoldprice.jsp"</span>).forward(req, resp);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>配置相关 Servlet 的映射关系 web.xml，如下：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KitcoGoldInfoProxyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.maxsoft.proxy.KitcoGoldInfoProxyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>InternationaleGoldPrice<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.maxsoft.proxy.InternationaleGoldPrice<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 省略其他代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KitcoGoldInfoProxyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/kitcogoldinfo<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>InternationaleGoldPrice<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/internationalegoldprice<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>编写 Ajax 代码逻辑来获取服务端数据，代码逻辑如下（com.maxsoft.base.js, com.maxsoft.proxy.js）：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@function </span>基础组件信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">MaxSoft</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date </span>2014-0-04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version </span>0.0.1 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> MaxSoftAjax = &#123;</span><br><span class="line">	_xhr : <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> xhr;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;<span class="comment">//兼容非IE低版本浏览器</span></span><br><span class="line">			xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;<span class="comment">//兼容IE低版本浏览器</span></span><br><span class="line">			xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">//事件监听请求执行到哪一步</span></span><br><span class="line">			<span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">					<span class="keyword">if</span> (<span class="keyword">typeof</span> (fn) == <span class="string">'function'</span>) &#123;</span><br><span class="line">						fn(xhr.responseText);</span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						alert(<span class="string">"参数无效，请检查！"</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="built_in">console</span>.log(<span class="string">"请求异常，"</span> + xhr.status);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="keyword">return</span> xhr;</span><br><span class="line">	&#125;,</span><br><span class="line">	AjaxGet:<span class="function"><span class="keyword">function</span>(<span class="params">url,fn</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> xhr = <span class="keyword">this</span>._xhr(fn);</span><br><span class="line">		xhr.open(<span class="string">"get"</span>, url, <span class="literal">true</span>);</span><br><span class="line">		xhr.send(<span class="literal">null</span>);</span><br><span class="line">	&#125;,</span><br><span class="line">	AjaxPost:<span class="function"><span class="keyword">function</span>(<span class="params">url,params,fn</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> xhr = <span class="keyword">this</span>._xhr(fn);</span><br><span class="line">		xhr.open(<span class="string">"post"</span>, url, <span class="literal">true</span>);</span><br><span class="line">		xhr.send(params);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@function </span>代理信息处理组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">MaxSoft</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date </span>2014-03-04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version </span>0.0.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> MaxSoftPlugins = &#123;</span><br><span class="line">	KitcoProxyInfo : <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">var</span> json = <span class="built_in">JSON</span>.parse(res);</span><br><span class="line">			<span class="built_in">document</span>.getElementById(<span class="string">"DIV__PRECIOUS_SPOT_PRICES_CNY"</span>).innerHTML = <span class="string">'&lt;div align="center" class="tabtitle" style="height:24px;line-height:24px;"&gt;以人民币/克计价&lt;/div&gt;'</span></span><br><span class="line">					+ json[<span class="number">0</span>];</span><br><span class="line">			<span class="built_in">document</span>.getElementById(<span class="string">"DIV__PRECIOUS_SPOT_PRICES"</span>).innerHTML = <span class="string">'&lt;div align="center" class="tabtitle" style="height:24px;line-height:24px;"&gt;以美元/盎司计价&lt;/div&gt;'</span></span><br><span class="line">					+ json[<span class="number">1</span>];</span><br><span class="line">			json[<span class="number">2</span>] = json[<span class="number">2</span>].replace(<span class="string">"width=\"550\""</span>, <span class="string">"width=\"795\""</span>)</span><br><span class="line">					.replace(<span class="string">"#e3effb;"</span>, <span class="string">"#dab66a; height='30' "</span>);</span><br><span class="line">			<span class="built_in">document</span>.getElementById(<span class="string">"DIV__SHANGHAI_PRICES"</span>).innerHTML = json[<span class="number">2</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		MaxSoftAjax.AjaxGet(url, fn);</span><br><span class="line">	&#125;,</span><br><span class="line">	CapitalCheckProxy : <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">		MaxSoftAjax.AjaxGet(url, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">			<span class="comment">//TODO</span></span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
<li>编写前端页面代码，如下：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=utf-8"</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="meta-string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=ISO-8859-1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>国际金价行情<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">media</span>=<span class="string">"all"</span> <span class="attr">href</span>=<span class="string">"assets/css/proxy.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"assets/js/com.maxsoft.base.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"assets/js/com.maxsoft.proxy.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"margin: 0px 0px 0px 0px;"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 809px; height: 1150px; margin-left: 13px;"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- Kitco Proxy Info --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">align</span>=<span class="string">"center"</span> <span class="attr">style</span>=<span class="string">"border: 0px; width: 100%;"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"center"</span> <span class="attr">colspan</span>=<span class="string">"2"</span> <span class="attr">height</span>=<span class="string">"30px"</span> <span class="attr">style</span>=<span class="string">"font-size: 16px; color: #926129; letter-spacing: 4px; font-weight: bold;"</span>&gt;</span>国际贵金属实时交易行情<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">"100%"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"DIV__SHANGHAI_PRICES"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">"100%"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"DIV__PRECIOUS_SPOT_PRICES_CNY"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">"100%"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"DIV__PRECIOUS_SPOT_PRICES"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">		MaxSoftPlugins.KitcoProxyInfo(<span class="string">"kitcogoldinfo"</span>);</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
以上代码运行效果如下图所示：<img src='/uploads/proxy_01.png' />通过上述示例我们发现只要分析出数据展现的规律或者某一个URL的数据结构就可以通过这种方式可以非常便捷的来获取大量我们需要的数据（微博相关数据，QQ空间数据等）。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/03/01/%E5%8E%9F%E7%94%9FAjax%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/apple-touch-icon-next.png">
      <meta itemprop="name" content="maxsoft">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxSoft">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2014/03/01/%E5%8E%9F%E7%94%9FAjax%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">原生Ajax请求数据过程总结</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表时间</span>

              <time title="创建时间：2014-03-01 21:11:12" itemprop="dateCreated datePublished" datetime="2014-03-01T21:11:12+08:00">2014-03-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ajax 是 Asynchronous Javascript And XML 的缩写，即异步的 JavaScript 和 XML，是一种创建交互式网页应用的网页开发技术。通过在后台与服务器进行少量数据交换，Ajax 可以使网页实现异步更新，增加用户的体验度。</p>
<h2 id="使用过程"><a href="#使用过程" class="headerlink" title="使用过程"></a>使用过程</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本次使用示例是通过Google Chrome浏览器为基础进行。<br/>1. 首先我们来创建可扩展超文本传输请求对象即（ XMLHttpRequest ），如下示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;<span class="comment">//兼容非IE低版本浏览器</span></span><br><span class="line">  xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;<span class="comment">//兼容IE低版本浏览器</span></span><br><span class="line">  xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于不同浏览器的内核的 XMLHttpRequest 对象创建方式不同（IE低版本，IE高版本，Google Chrome ，火狐浏览器等），所以我们要满足不同浏览器的 Ajax 请求平稳运行，就要区分不同浏览器进行兼容处理；<br><font>2. 其次设置请求请求响应回调事件，如下示例：</font></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xhr.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  <span class="comment">//事件监听请求执行到哪一步</span></span><br><span class="line">   <span class="keyword">if</span>(xhr.readyState === <span class="number">4</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(xhr.status === <span class="number">200</span>)&#123;</span><br><span class="line">         <span class="keyword">var</span> header = xhr.getAllResponseHeaders();  <span class="comment">//获得所有响应头</span></span><br><span class="line">	 <span class="built_in">console</span>.log(<span class="string">"请求成功!"</span> + xhr.responseText);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="string">"请求异常，"</span> + xhr.status);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 xhr.readyState 的值有如下含义：</p>
<ol>
<li><font color=red>&nbsp;&nbsp;0&nbsp;(未初始化)</font>：(XMLHttpRequest)对象已经创建，但还没有调用open()方法；</li>
<li><font color=red>&nbsp;&nbsp;1&nbsp;(载入)</font>：已经调用open() 方法，但尚未发送请求；</li>
<li><font color=red>&nbsp;&nbsp;2&nbsp;(载入完成)</font>：请求已经发送完成；</li>
<li><font color=red>&nbsp;&nbsp;3&nbsp;(交互)</font>：可以接收到部分响应数据；</li>
<li><font color=red>&nbsp;&nbsp;4&nbsp;(完成)</font>：已经接收到了全部数据，并且连接已经关闭；</li>
</ol>
<p>xhr.status 主要用来辅助判断服务器的响应状态，有如下几类，：</p>
<ol>
<li><font color=red>&nbsp;&nbsp;1xx&nbsp;(信息类)</font>：表示收到Web浏览器请求，正在进一步的处理中。如，100：客户必须继续发出请求；101：客户要求服务器根据请求转换HTTP协议版本；</li>
<li><font color=red>&nbsp;&nbsp;2xx&nbsp;(成功)</font>：表示用户请求被正确接收，理解和处理。例如，200：OK；201：提示知道新文件的URL；</li>
<li><font color=red>&nbsp;&nbsp;3xx&nbsp;(重定向)</font>：表示请求没有成功，客户必须采取进一步的动作。如，300：请求的资源可在多处得到；301：删除请求数据；</li>
<li><font color=red>&nbsp;&nbsp;4xx&nbsp;(客户端错误)</font>：表示客户端提交的请求有错误。如，404：NOT Found，意味着请求中所引用的文档不存在；</li>
<li><font color=red>&nbsp;&nbsp;5xx&nbsp;(服务器错误)</font>：表示服务器不能完成对请求的处理。如，500，服务器产生内部错误；</li>
</ol>
<p><font>3. 最后设置相关请求参数并发送请求，如下示例：</font></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xhr.open(<span class="string">"post"</span>,<span class="string">"/maxsoft/user/add"</span>,<span class="literal">true</span>); <span class="comment">//设置请求方法（[方法名][post/get], [请求地址], [异步标识][true/false]）</span></span><br><span class="line">xhr.setRequestHeader(<span class="string">"Content-Type"</span>,<span class="string">"text/html; charset=utf-8"</span>); <span class="comment">//设置请头相关的参数</span></span><br><span class="line">xhr.send(&#123;<span class="attr">name</span>:<span class="string">'MaxSoft'</span>,<span class="attr">sex</span>:<span class="string">'1'</span>,<span class="attr">id</span>:<span class="string">'10000000001'</span>&#125;); <span class="comment">//设置请求参数</span></span><br></pre></td></tr></table></figure>
<p>在这一步中主要是发送请求以及请求参数等，其中 xhr.open() 方法参数依次为：请求方法（POST/GET），以及请求地址，是否异步（true/false）；xhr.send() 方法为发送请求的过程中的请求参数，主要用于 POST 方法，如果没有参数则为 null;</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通过以上三步操作即可完成一次 Ajax 请求操作，我们可以在第二部中增加 Ajax 请求成功（xhr.readyState === 4 并且 xhr.status === 200 ）后的相关执行逻辑；在我当前的毕设中主要用在前端页面无感知刷新以及门店数据分布位置的请求；</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/02/27/JavaWeb%E9%A1%B9%E7%9B%AE%E5%B5%8C%E5%85%A5%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E5%8A%9F%E8%83%BD%E6%B5%81%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/apple-touch-icon-next.png">
      <meta itemprop="name" content="maxsoft">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxSoft">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2014/02/27/JavaWeb%E9%A1%B9%E7%9B%AE%E5%B5%8C%E5%85%A5%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E5%8A%9F%E8%83%BD%E6%B5%81%E7%A8%8B/" class="post-title-link" itemprop="url">JavaWeb项目嵌入百度地图功能流程</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表时间</span>

              <time title="创建时间：2014-02-27 19:51:12" itemprop="dateCreated datePublished" datetime="2014-02-27T19:51:12+08:00">2014-02-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最近俩天终于梳理清楚了毕设中的单独功能模块，首先就是关于企业加盟店的地图动态显示功能模块。由于服务端的功能相对比较简单只是单纯的录入分店地址后，将其转换为对应的GPS坐标返回给前端即可，所以这里不做过多的记录。今天主要记录在前端页面中嵌入百度地图并根据服务端提供的数据来动态的标记在地图中以便用户可以清晰的看到企业的各加盟分店分布情况。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>开始该功能之前主要准备的工作如下：</p>
<ol>
<li><p>申请百度开发者账号；</p>
</li>
<li><p>通过申请到的百度开发者账号在控制台建立一个提供Web服务的应用实例；</p>
</li>
<li><p>获取Web应用实例中提供的访问应用秘钥AK；</p>
</li>
</ol>
<p>以上操作的地址【<a href="https://passport.baidu.com/v2/?login&u=http%3A%2F%2Flbsyun.baidu.com%2Fapiconsole%2Fkey" target="_blank" rel="noopener">百度开发者</a>】，这里就不再演示了。</p>
<h2 id="嵌入流程"><a href="#嵌入流程" class="headerlink" title="嵌入流程"></a>嵌入流程</h2><ol>
<li>首先通过申请的百度开发者账号来获取访问应用AK，并嵌入到页面中，如下：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 省略其他代码 --&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"http://api.map.baidu.com/api?v=2.0&amp;ak=xxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li>参考百度地图API进行地图嵌入代码的编写( MaxSoftPlugins.js )，以下为粗略的封装代码：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$MaxSoftMapPlugin</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> _map_div = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">	<span class="keyword">if</span>(_map_div == <span class="literal">null</span> || <span class="keyword">typeof</span>(_map_div)==<span class="string">'undefined'</span>)&#123;</span><br><span class="line">		alert(<span class="string">"请输入有效的ID值"</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		BaiduMap : <span class="function"><span class="keyword">function</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">var</span> _args = <span class="built_in">arguments</span>;</span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">typeof</span>(options)==<span class="string">'object'</span>)&#123;</span><br><span class="line">				<span class="comment">/***********************************************************************************************/</span></span><br><span class="line">				<span class="keyword">var</span> _data = options.data;</span><br><span class="line"></span><br><span class="line">				<span class="comment">//通过指定容器的ID创建百度地图</span></span><br><span class="line">				<span class="keyword">var</span> _map = <span class="keyword">new</span> BMap.Map(id);</span><br><span class="line">				<span class="comment">//定义一个中心点坐标</span></span><br><span class="line">				<span class="keyword">var</span> _point = <span class="keyword">new</span> BMap.Point(<span class="number">116.609973</span> , <span class="number">39.930236</span>); </span><br><span class="line">				<span class="comment">//设定地图的中心点和坐标并将地图显示在地图容器中</span></span><br><span class="line">				_map.centerAndZoom(_point, <span class="number">14</span>);</span><br><span class="line">				<span class="comment">//window.map = _map; //将map变量存储在全局</span></span><br><span class="line">				<span class="comment">//启用地图拖拽事件，默认启用(可不写)</span></span><br><span class="line">				_map.enableDragging(); </span><br><span class="line">				<span class="comment">//启用地图滚轮放大缩小</span></span><br><span class="line">				_map.enableScrollWheelZoom();</span><br><span class="line">				<span class="comment">//启用鼠标双击放大，默认启用(可不写)</span></span><br><span class="line">				_map.enableDoubleClickZoom(); </span><br><span class="line">				<span class="comment">//启用键盘上下左右键移动地图</span></span><br><span class="line">				_map.enableKeyboard(); </span><br><span class="line">				<span class="built_in">window</span>.mapobj = _map;</span><br><span class="line">				<span class="comment">//向地图中添加缩放控件</span></span><br><span class="line">				<span class="keyword">var</span> _ctrl_nav = <span class="keyword">new</span> BMap.NavigationControl(&#123; <span class="attr">anchor</span>: BMAP_ANCHOR_TOP_LEFT, <span class="attr">type</span>: BMAP_NAVIGATION_CONTROL_LARGE &#125;);</span><br><span class="line">				_map.addControl(_ctrl_nav);</span><br><span class="line">				<span class="comment">//向地图中添加缩略图控件</span></span><br><span class="line">				<span class="keyword">var</span> _ctrl_ove = <span class="keyword">new</span> BMap.OverviewMapControl(&#123; <span class="attr">anchor</span>: BMAP_ANCHOR_BOTTOM_RIGHT, <span class="attr">isOpen</span>: <span class="number">1</span> &#125;);</span><br><span class="line">				_map.addControl(_ctrl_ove);</span><br><span class="line">				<span class="comment">//向地图中添加比例尺控件</span></span><br><span class="line">				<span class="keyword">var</span> _ctrl_sca = <span class="keyword">new</span> BMap.ScaleControl(&#123; <span class="attr">anchor</span>: BMAP_ANCHOR_BOTTOM_LEFT&#125;);</span><br><span class="line">				_map.addControl(_ctrl_sca);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">var</span> _markerData = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;_data.length;i++)&#123;</span><br><span class="line">					_markerData[i]=&#123; </span><br><span class="line">						title:<span class="string">'&lt;table cellspacing=0 cellpadding=0 border=0 height=20 width=450px style="font-size:14px; color:#b48d40;font-weight:bold;"&gt;&lt;tr&gt;&lt;td width=20px align=left valign=middle&gt;&lt;img src="http://api.map.baidu.com/lbsapi/getpoint/Images/logo.gif" height=20px width=20px/&gt;&lt;/td&gt;&lt;td align=left valign=middle &gt;&amp;nbsp;'</span>+_data[i].FName+<span class="string">'&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;'</span>, </span><br><span class="line">						content: <span class="string">"&lt;b style='font-size:12px; color:#b48d40;'&gt;电话："</span>+_data[i].FConnPhone+<span class="string">"&lt;br/&gt;地址："</span>+_data[i].FAddress, </span><br><span class="line">						point:_data[i].FIntroduce, </span><br><span class="line">						isOpen: <span class="number">0</span>, </span><br><span class="line">						icon: &#123; <span class="attr">w</span>: <span class="number">20</span>, <span class="attr">h</span>: <span class="number">24</span>, <span class="attr">l</span>: <span class="number">46</span>, <span class="attr">t</span>: <span class="number">22</span>, <span class="attr">x</span>: <span class="number">6</span>, <span class="attr">lb</span>: <span class="number">10</span>&#125; </span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; _markerData.length; i++) &#123;</span><br><span class="line">					<span class="keyword">var</span> _marker_data = _markerData[i];</span><br><span class="line">					<span class="keyword">var</span> _p0 = _marker_data.point.split(<span class="string">"|"</span>)[<span class="number">0</span>];</span><br><span class="line">					<span class="keyword">var</span> _p1 = _marker_data.point.split(<span class="string">"|"</span>)[<span class="number">1</span>];</span><br><span class="line">					<span class="keyword">var</span> _point = <span class="keyword">new</span> BMap.Point(_p0, _p1);</span><br><span class="line">					<span class="keyword">var</span> _iconImg = createIcon(_marker_data.icon);</span><br><span class="line">					<span class="keyword">var</span> _marker = <span class="keyword">new</span> BMap.Marker(_point, &#123; <span class="attr">icon</span>: _iconImg &#125;);</span><br><span class="line">					<span class="keyword">var</span> _label = <span class="keyword">new</span> BMap.Label(_marker_data.title, &#123; <span class="string">"offset"</span>: <span class="keyword">new</span> BMap.Size(_marker_data.icon.lb - _marker_data.icon.x + <span class="number">10</span>, <span class="number">-20</span>) &#125;);</span><br><span class="line">					_label.setStyle(&#123;<span class="attr">border</span>:<span class="string">"#eabc3c solid 1px"</span>&#125;);</span><br><span class="line">					_marker.setLabel(_label);</span><br><span class="line">					_map.addOverlay(_marker);</span><br><span class="line">					_label.setStyle(&#123;</span><br><span class="line">						borderColor: <span class="string">"#eabc3c"</span>,</span><br><span class="line">						color: <span class="string">"#333"</span>,</span><br><span class="line">						cursor: <span class="string">"pointer"</span></span><br><span class="line">					&#125;);</span><br><span class="line">					(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">						<span class="keyword">var</span> _iw = createInfoWindow(i);</span><br><span class="line">						<span class="keyword">var</span> _marker_obj = _marker;</span><br><span class="line">						_marker_obj.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">						<span class="keyword">this</span>.openInfoWindow(_iw);</span><br><span class="line">						&#125;);</span><br><span class="line">						_iw.addEventListener(<span class="string">"open"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">						_marker_obj.getLabel().hide();</span><br><span class="line">						&#125;)</span><br><span class="line">						_iw.addEventListener(<span class="string">"close"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">						_marker_obj.getLabel().show();</span><br><span class="line">						&#125;)</span><br><span class="line">						_label.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">						_marker_obj.openInfoWindow(_iw);</span><br><span class="line">						&#125;)</span><br><span class="line">						<span class="keyword">if</span> (!!_marker_data.isOpen) &#123;</span><br><span class="line">						_label.hide();</span><br><span class="line">						_marker_obj.openInfoWindow(_iw);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;)()</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">//创建InfoWindow</span></span><br><span class="line">				<span class="function"><span class="keyword">function</span> <span class="title">createInfoWindow</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">				<span class="keyword">var</span> md = _markerData[i];</span><br><span class="line">				<span class="keyword">var</span> iw = <span class="keyword">new</span> BMap.InfoWindow(<span class="string">"&lt;b class='iw_poi_title' title='"</span> + md.title + <span class="string">"'&gt;"</span> + md.title + <span class="string">"&lt;/b&gt;&lt;div class='iw_poi_content'&gt;"</span> + md.content + <span class="string">"&lt;/div&gt;"</span>);</span><br><span class="line">				<span class="keyword">return</span> iw;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">//创建一个Icon</span></span><br><span class="line">				<span class="function"><span class="keyword">function</span> <span class="title">createIcon</span>(<span class="params">md</span>) </span>&#123;</span><br><span class="line">				<span class="keyword">var</span> icon = <span class="keyword">new</span> BMap.Icon(<span class="string">"http://app.baidu.com/map/images/us_mk_icon.png"</span>, <span class="keyword">new</span> BMap.Size(md.w, md.h), &#123; <span class="attr">imageOffset</span>: <span class="keyword">new</span> BMap.Size(-md.l, -md.t), <span class="attr">infoWindowOffset</span>: <span class="keyword">new</span> BMap.Size(md.lb + <span class="number">5</span>, <span class="number">1</span>), <span class="attr">offset</span>: <span class="keyword">new</span> BMap.Size(md.x, md.h) &#125;)</span><br><span class="line">				<span class="keyword">return</span> icon;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(<span class="keyword">typeof</span>(options.callback)==<span class="string">'function'</span>)&#123;</span><br><span class="line">					options.callback();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span>(options)==<span class="string">'string'</span>)&#123;</span><br><span class="line">				<span class="keyword">var</span> method = &#123;</span><br><span class="line">					test : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">						<span class="built_in">console</span>.log(<span class="string">"This is test method."</span>);</span><br><span class="line">					&#125;,</span><br><span class="line">					addMarker:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">						<span class="keyword">var</span> point = <span class="keyword">new</span> BMap.Point(_args[<span class="number">1</span>].x,_args[<span class="number">1</span>].y);</span><br><span class="line">						<span class="comment">// 创建点坐标</span></span><br><span class="line">						mapobj.centerAndZoom(point,_args[<span class="number">1</span>].grade);</span><br><span class="line">						<span class="comment">// 初始化地图， 设置中心点坐标和地图级别</span></span><br><span class="line">						<span class="keyword">var</span> marker = <span class="keyword">new</span> BMap.Marker(point);</span><br><span class="line">						marker.title=<span class="string">'&lt;table cellspacing=0 cellpadding=0 border=0 height=20 width=250px style="font-size:14px; color:#b48d40;font-weight:bold;"&gt;&lt;tr&gt;&lt;td width=20px align=left valign=middle&gt;&lt;img src="'</span>+_args[<span class="number">1</span>].icon+<span class="string">'" height=20px width=20px/&gt;&lt;/td&gt;&lt;td align=left valign=middle &gt;&amp;nbsp;'</span>+_args[<span class="number">1</span>].name+<span class="string">'&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;'</span>;</span><br><span class="line">						marker.content= <span class="string">"&lt;b style='font-size:12px; color:#b48d40;'&gt;电话："</span>+_args[<span class="number">1</span>].phone+<span class="string">"&lt;br/&gt;地址："</span>+_args[<span class="number">1</span>].address; </span><br><span class="line">						marker.isOpen=<span class="number">0</span>;</span><br><span class="line">						marker.icon= &#123; <span class="attr">w</span>: <span class="number">20</span>, <span class="attr">h</span>: <span class="number">24</span>, <span class="attr">l</span>: <span class="number">46</span>, <span class="attr">t</span>: <span class="number">22</span>, <span class="attr">x</span>: <span class="number">6</span>, <span class="attr">lb</span>: <span class="number">10</span>&#125; ;</span><br><span class="line">						mapobj.addOverlay(marker);</span><br><span class="line">						<span class="keyword">var</span> label = <span class="keyword">new</span> BMap.Label(marker.title, &#123; <span class="string">"offset"</span>: <span class="keyword">new</span> BMap.Size(marker.icon.lb - marker.icon.x + <span class="number">10</span>, <span class="number">-20</span>) &#125;);</span><br><span class="line">						label.setStyle(&#123;<span class="attr">border</span>:<span class="string">"#eabc3c solid 1px"</span>,<span class="attr">background</span>:<span class="string">"#cecece"</span>&#125;);</span><br><span class="line">						marker.setLabel(label);</span><br><span class="line">						label.setStyle(&#123;</span><br><span class="line">							borderColor: <span class="string">"#eabc3c"</span>,</span><br><span class="line">							color: <span class="string">"#333"</span>,</span><br><span class="line">							cursor: <span class="string">"pointer"</span></span><br><span class="line">						&#125;);</span><br><span class="line">						label.hide();</span><br><span class="line">						<span class="keyword">var</span> iw = <span class="keyword">new</span> BMap.InfoWindow(<span class="string">"&lt;b class='iw_poi_title' title='"</span>+marker.title+<span class="string">"'&gt;"</span>+marker.title+<span class="string">"&lt;/b&gt;&lt;div class='iw_poi_content'&gt;"</span>+marker.content+<span class="string">"&lt;/div&gt;"</span>);</span><br><span class="line">						marker.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">evt</span>) </span>&#123;</span><br><span class="line">							 <span class="keyword">this</span>.openInfoWindow(iw);</span><br><span class="line">						&#125;);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> method[options]();</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">//TODO</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>页面调用代码以及效果图如下：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"window-target"</span> <span class="attr">content</span>=<span class="string">"_top"</span>&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"cache-control"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"date"</span> <span class="attr">content</span>=<span class="string">"2014-02-26"</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"/logo.ico"</span> <span class="attr">type</span>=<span class="string">"image/x-icon"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"shortcut icon"</span> <span class="attr">href</span>=<span class="string">"/logo.ico"</span> <span class="attr">type</span>=<span class="string">"image/x-icon"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"http://api.map.baidu.com/api?v=2.0&amp;ak=uFr65XlDBuvhvGYxw3UddQ7N"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"MaxSoftPlugins.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"margin: 0px 0px 0px 0px;"</span> <span class="attr">align</span>=<span class="string">'center'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"map_content_div"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width:600px;height:400px;border:#eabc3c solid 1px;"</span> <span class="attr">id</span>=<span class="string">"map_content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">	<span class="keyword">var</span> data = [&#123;FConnPhone : <span class="string">"13602058888"</span>, FName : <span class="string">"MaxSoft Telecom Network Technology Co., Ltd"</span>, FAddress : <span class="string">"北京市朝阳区 XXXX  "</span>, FIntroduce : <span class="string">"116.609973|39.930236"</span> &#125;];</span></span><br><span class="line"><span class="actionscript">	$MaxSoftMapPlugin(<span class="string">"map_content"</span>).BaiduMap(&#123;data:data,callback:<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="built_in">console</span>.log(<span class="string">'Hello MaxSoft, 我要居中处理'</span>);</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> left  = (<span class="built_in">window</span>.screen.availWidth - <span class="built_in">parseInt</span>(<span class="built_in">document</span>.getElementById(<span class="string">"map_content"</span>).style.width) ) / <span class="number">2</span>;</span></span><br><span class="line"><span class="javascript">		<span class="built_in">document</span>.getElementById(<span class="string">"map_content_div"</span>).style[<span class="string">'padding-left'</span>] = left;</span></span><br><span class="line">	&#125;&#125;);</span><br><span class="line"><span class="actionscript">	$MaxSoftMapPlugin(<span class="string">"map_content"</span>).BaiduMap(<span class="string">'addMarker'</span>,&#123;grade:<span class="number">9</span>, </span></span><br><span class="line">		x:116.404, </span><br><span class="line">		y:39.915, </span><br><span class="line"><span class="actionscript">		name:<span class="string">"XXXXX西单分店"</span>,</span></span><br><span class="line"><span class="actionscript">		phone:<span class="string">'13602058888'</span>, </span></span><br><span class="line"><span class="actionscript">		address:<span class="string">"北京市西城区西单大悦城XXXX号"</span>, </span></span><br><span class="line"><span class="actionscript">		icon:<span class="string">'http://img.zcool.cn/community/018ac455ba317d32f87528a1dbc0e5.jpg'</span>&#125;);</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="/uploads/map_0001.png" /><img src="/uploads/map_0002.png" /><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;以上就是本次关于分店展示的功能模块的锥形，后面会进行详细的需求整理并设计。关于动态数据准备使用原生的 Ajax 来进行服务端数据的异步加载以满足我们在后台对分店的动态信息的可可编辑需求。</li>
</ol>
<p>参考信息 : <a href="http://lbsyun.baidu.com/index.php?title=jspopular" target="_blank" rel="noopener">百度地图API</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2013/11/23/J2EE%E4%B9%8BJSP%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/apple-touch-icon-next.png">
      <meta itemprop="name" content="maxsoft">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxSoft">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2013/11/23/J2EE%E4%B9%8BJSP%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">J2EE之JSP技术学习总结</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表时间</span>

              <time title="创建时间：2013-11-23 22:20:30" itemprop="dateCreated datePublished" datetime="2013-11-23T22:20:30+08:00">2013-11-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;学习JSP技术也有小一个学期的时间了，借今天是周末的时间来简单的做一个总结。也为下一个月底开始的期末考试做个准备，免去挂科补考之苦 &gt;V&lt;……</p>
<h2 id="JSP概念"><a href="#JSP概念" class="headerlink" title="JSP概念"></a>JSP概念</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JSP的全名是Java Server Pages，翻译为中文名就是Java服务器页面。JSP的本质是一个简化的Servlet，它是由Sun公司提倡并参与组建的一种动态网站页面技术。JSP是由HTML标记语言，Java程序代码，JSP标签而组成的扩展名为.jsp的文本文件。使用JSP开发的网站应用可以在任何装有JRE运行环境和JavaWeb容器的操作系统上运行，即跨平台性比较好。</p>
<h2 id="JSP语法"><a href="#JSP语法" class="headerlink" title="JSP语法"></a>JSP语法</h2><p>JSP的语法有如下几类：</p>
<pre><code>1&gt; &lt;%@    ...    %&gt;  定义JSP指令

2&gt; &lt;%!    ...    %&gt;  定义Java代码段的全局成员变量

3&gt; &lt;%     ...    %&gt;  定义Java成员变量,编写Java处理逻辑

4&gt; &lt;%=    ...    %&gt;  输出内容到页面

5&gt; &lt;xxx:xxx xx=&quot;&quot; ... &gt; ... &lt;/xxx:xxx&gt; 系统JSP标签 第三方标签 以及 自定义标签 </code></pre><p>JSP页面示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">"java.util.Date"</span>%&gt;</span><br><span class="line">&lt;%-- &lt;%<span class="meta">@include</span> file=<span class="string">"personal.jsp"</span> %&gt; --%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"spring"</span> uri=<span class="string">"http://www.springframework.org/tags"</span>%&gt;</span><br><span class="line">&lt;%-- &lt;%<span class="meta">@taglib</span> prefix=<span class="string">"custome"</span> tagdir=<span class="string">"自定义标签路径"</span>%&gt; --%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;%! String flag = <span class="string">"MaxSoft"</span>; %&gt;</span><br><span class="line">&lt;%! <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DateUtils</span></span>&#123;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">getNowDate</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Date();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; </span><br><span class="line">%&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;jsp:include page=<span class="string">"maxsoft.jsp"</span>/&gt;</span><br><span class="line">&lt;%-- &lt;spring:message text="Spring"&gt;&lt;/spring:message&gt; --%&gt;</span><br><span class="line">&lt;% String date = DateUtils.getNowDate().toLocaleString(); %&gt;</span><br><span class="line"></span><br><span class="line">北京时间：</span><br><span class="line"></span><br><span class="line">&lt;%=flag + <span class="string">":"</span> + date %&gt;</span><br><span class="line">&lt;%-- 注释内容 --%&gt;</span><br><span class="line">&lt;%-- &lt;% String name = <span class="string">"MaxSoft"</span>; %&gt; --%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>运行效果：<br><img  src="/uploads/jsp.png"/></p>
<h2 id="JSP标签库"><a href="#JSP标签库" class="headerlink" title="JSP标签库"></a>JSP标签库</h2><p>在使用JSP标签之前要在JSP页面中通过<font color=red>&lt;%@taglib prefix=”标签前缀” uri=“网络标签库地址” %&gt;</font> 或 <font color=red>&lt;%@taglib  prefix=”标签前缀”  tagdir=“自定义标签库地址” %&gt;</font> 将要使用的标签导入到当前的JSP页面中才可以使用。当然在JSP页面中有系统默认的标签库，是不需要导入就可以使用。具体可以参照以上的JSP页面示例。</p>
<p>我们在JSP中常用的标签有如下几种：</p>
<pre><code>1&gt; &lt;%@page import=“” language=&quot;&quot; pageEncoding=“” contentType=&quot;&quot; autoFlush=&quot;&quot; buffer=&quot;&quot; errorPage=&quot;&quot; %&gt;
     --import 用于将java类包导入到当前页面，可以导入多个，用“,”分割
     --language 用于指定服务器端的语言环境 默认为Java
     --pageEncoding 指定页面编码
     --contentType 指定当前页面的编码方式
     --autoFlush 自动刷新缓冲区
     --buffer 响应输出流的缓冲区大小，默认8KB
     --errorPage 指定错误页面，也可以在web.xml中设置

2&gt; &lt;%@include file=&quot;b.jsp&quot;%&gt; 包含指定页面的内容

3&gt; &lt;%@taglib prefix=&quot;spring&quot; uri=&quot;http://www.springframework.org/tags&quot; %&gt; 引入指定的标签库

4&gt; &lt;jsp:useBean  id=&quot;user&quot; class=&quot;org.maxsoft.User&quot;&gt; 引入指定的类并创建该类实例
5&gt; &lt;jsp:setProperty name=&quot;user&quot; property=&quot;name&quot; value=&quot;maxsoft&quot;&gt; 对应类实例设置属性
6&gt; &lt;jsp:getProperty name=&quot;user&quot; property=&quot;name&quot;&gt; 获取类实例的属性
7&gt; 其他的逻辑控制标签，页面跳转标签等</code></pre><h2 id="JSP内置对象"><a href="#JSP内置对象" class="headerlink" title="JSP内置对象"></a>JSP内置对象</h2><p>JSP的内置对象总共有9个(作用域由大到小)，分别是<br><font color=red>application</font> (javax.servlet.ServletContext) <font color=green>作用域 Application，随着Web容器的生命周期而存在</font>；<br><font color=red>session</font>(javax.servlet.http.HttpSession) <font color=green>作用域 Session，随着一次有效会话的生命周期而存在</font>；<br><font color=red>request</font>(javax.servlet.ServletRequest) <font color=green>作用域 Request，随着一次请求而存在</font>；<br><font color=red>pageContext</font>(javax.servlet.jsp.PageContext) <font color=green>作用域 Page，只在当前页面有效</font>；<br><font color=red>response</font>(javax.servlet.SrvletResponse) <font color=green>作用域 Page，只在当前页面有效</font>；<br><font color=red>out</font>(javax.servlet.jsp.JspWriter) <font color=green>作用域 Page，只在当前页面有效</font>；<br><font color=red>page</font>(当前页面对象及javax.lang.Object) <font color=green>作用域 Page，只在当前页面有效</font>；<br><font color=red>exception</font>(javax.lang.Throwable) <font color=green>作用域 Page，只在当前页面有效</font>；<br><font color=red>config</font>(javax.servlet.ServletConfig) <font color=green>作用域 Page，只在当前页面有效</font>；<br>其中out与response.write()不要同时使用，因为在服务响应之前，Web容器会先把out缓冲区的数据刷新给response对象中，然后才在response独享缓冲区获取响应数据。</p>
<h2 id="JSP的工作原理"><a href="#JSP的工作原理" class="headerlink" title="JSP的工作原理"></a>JSP的工作原理</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当浏览器发起一个请求到WEB容器，如果请求地址是以.jsp结尾时，Web容器则会把请求交给JSP引擎来编译执行。如果请求地址没有.jsp结尾时，Web容器会在Web.xml中查询对应的Servlet映射页面（存在jsp与Servlet的映射关系）解析编译并执行或直接执行Servlet并响应结果信息到客户端；Web容器中的JSP引擎就是一个Servlet程序，它负责解释和执行JSP页面。即把jsp页面交给JSP引擎翻译成一个Servlet程序，然后把该Servlet程序编译成Servlet的class文件，最后由WEB容器来装载和解释执行这个被编译后的Servlet程序，并响应结果给客户端。 </p>
<p>More info: <a href="http://www.oracle.com/technetwork/java/javaee/jsp/index.html" target="_blank" rel="noopener">Java Server Page</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2013/11/10/struts2%E6%95%B4%E5%90%88kindeditor(4.1.8)%E8%BF%87%E7%A8%8B%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/apple-touch-icon-next.png">
      <meta itemprop="name" content="maxsoft">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxSoft">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2013/11/10/struts2%E6%95%B4%E5%90%88kindeditor(4.1.8)%E8%BF%87%E7%A8%8B%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">struts2整合kindeditor(4.1.8)过程总结</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表时间</span>

              <time title="创建时间：2013-11-10 23:42:49" itemprop="dateCreated datePublished" datetime="2013-11-10T23:42:49+08:00">2013-11-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaWeb%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb第三方框架</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前些日子一个跑业务的朋友帮我接到一个小的项目，其中有好多模块用到了富文本编辑器，在网上找了好多，也看了好多，综合各方面的因素最后选择了kindeditor4.1.8，网上搜索了一下也没有看到一个帖子完完整整的介绍kindeditor4.1.8与struts2整合的过程，到是检索到了零零散散的几分文章作用不是太大<del>~</del>好吧，自己动手吧，于是乎我打开了下载的kindeditor4.1.8的组件包，找到了其中的jsp上传文件的那一部分内容看了一边。开始编写Action（个人认为既然都用了struts2框架了就不想写servlet 了）。在这个过程中遇到了很多问题，不过都一一解决了。<br>好了，废话不多说了，开始整合过程：</p>
<h2 id="详细过程"><a href="#详细过程" class="headerlink" title="详细过程"></a>详细过程</h2><p>1.首先下载&nbsp;&nbsp;<a href="http://kindeditor.net/view.php?bbsid=3&postid=7868" target="_blank">kindeditor4.1.8</a><br>2.打开下载的kindeditor4.1.8的包，先瘦身，把其中的不需要的文件删除掉如下图所示：<br><img src="http://img.blog.csdn.net/20131110105155562?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbWF4MTI2MzEz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">3、建立Web项目，并加入struts2的依赖后，把kindeditor4.1.8中的jsp文件夹中的lib里面的json_simple-1.1.jar加入到构建路径中。<br>4、把kindeditor4.1.8的jsp文件剪切到外面，然后将剩下的全部拷贝到项目的WebRoot下，并建立文件夹attached（上传文件的存储区域）<br>5、开始创建包、编写action，其中的内容是重写了jsp/upload_json.jsp中的部分内容。代码重写的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.maxsoft.action;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.File;  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;  </span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;  </span><br><span class="line"><span class="keyword">import</span> java.util.Date;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Random;  </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;  </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;  </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;  </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.dispatcher.multipart.MultiPartRequestWrapper;  </span><br><span class="line"><span class="keyword">import</span> org.json.simple.JSONObject;  </span><br><span class="line"><span class="keyword">import</span> org.maxsoft.tools.FileTools;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadJsonAction</span> </span>&#123;  </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadJson</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">	<span class="comment">//标注  最大文件大小  </span></span><br><span class="line">        <span class="keyword">long</span> maxSize = <span class="number">1024</span>*<span class="number">1024</span>*<span class="number">2</span>;  </span><br><span class="line">        <span class="comment">//获取Struts2中的多媒体请求包装器对象  </span></span><br><span class="line">        MultiPartRequestWrapper requestWrapper = (MultiPartRequestWrapper) ActionContext.getContext().get(ServletActionContext.HTTP_REQUEST);  </span><br><span class="line">        <span class="comment">/** </span></span><br><span class="line"><span class="comment">         * 通过imgFile获取kindeditor文件上传组件中的文件组以及文件名组 </span></span><br><span class="line"><span class="comment">         * imgFile是通过分析requestWrapper而拿到的。如下： </span></span><br><span class="line"><span class="comment">         * Enumeration attributeNames = requestWrapper.getFileParameterNames(); </span></span><br><span class="line"><span class="comment">         * System.out.println(attributeNames.nextElement()); </span></span><br><span class="line"><span class="comment">         */</span>  </span><br><span class="line">        <span class="comment">//文件名字符串数组  </span></span><br><span class="line">        String[] fileNames = requestWrapper.getFileNames(<span class="string">"imgFile"</span>);  </span><br><span class="line">        <span class="comment">//文件数组  </span></span><br><span class="line">        File[] files = requestWrapper.getFiles(<span class="string">"imgFile"</span>);  </span><br><span class="line">        <span class="comment">// 自定义文件上传工具  </span></span><br><span class="line">        FileTools fileTools = <span class="keyword">new</span> FileTools();  </span><br><span class="line">	<span class="comment">// 获取请求对象  </span></span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) ActionContext.getContext().get(ServletActionContext.HTTP_REQUEST);  </span><br><span class="line">        <span class="comment">// 获取响应对象  </span></span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) ActionContext.getContext().get(ServletActionContext.HTTP_RESPONSE);  </span><br><span class="line">        <span class="comment">// 文件保存目录路径  </span></span><br><span class="line">        String savePath = ServletActionContext.getServletContext().getRealPath(<span class="string">"/"</span>)+ <span class="string">"attached\\"</span>;  </span><br><span class="line">        <span class="comment">// 文件保存目录URL  </span></span><br><span class="line">        String saveUrl = ServletActionContext.getServletContext().getContextPath() + <span class="string">"/attached/"</span>;  </span><br><span class="line">        <span class="comment">// 定义允许上传的文件扩展名  </span></span><br><span class="line">        HashMap&lt;String, String&gt; extMap = <span class="keyword">new</span> HashMap&lt;String, String&gt;();  </span><br><span class="line">        extMap.put(<span class="string">"image"</span>, <span class="string">"gif,jpg,jpeg,png,bmp"</span>);  </span><br><span class="line">        extMap.put(<span class="string">"flash"</span>, <span class="string">"swf,flv"</span>);  </span><br><span class="line">        extMap.put(<span class="string">"media"</span>, <span class="string">"swf,flv,mp3,wav,wma,wmv,mid,avi,mpg,asf,rm,rmvb"</span>);  </span><br><span class="line">        extMap.put(<span class="string">"file"</span>, <span class="string">"doc,docx,xls,xlsx,ppt,htm,html,txt,zip,rar,gz,bz2"</span>);  </span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);  </span><br><span class="line">        <span class="keyword">if</span> (!ServletFileUpload.isMultipartContent(request)) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                response.getWriter().println(getError(<span class="string">"请选择文件。"</span>));  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">                System.err.println(e.getMessage());  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// 检查目录  </span></span><br><span class="line">        File uploadDir = <span class="keyword">new</span> File(savePath);  </span><br><span class="line">        <span class="keyword">if</span> (!uploadDir.isDirectory()) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                response.getWriter().println(getError(<span class="string">"上传目录不存在。"</span>));  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">                System.err.println(e.getMessage());  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// 检查目录写权限  </span></span><br><span class="line">        <span class="keyword">if</span> (!uploadDir.canWrite()) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                response.getWriter().println(getError(<span class="string">"上传目录没有写权限。"</span>));  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">                System.err.println(e.getMessage());  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        String dirName = request.getParameter(<span class="string">"dir"</span>);  </span><br><span class="line">        <span class="keyword">if</span> (dirName == <span class="keyword">null</span>) &#123;  </span><br><span class="line">            dirName = <span class="string">"image"</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (!extMap.containsKey(dirName)) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                response.getWriter().println(getError(<span class="string">"目录名不正确。"</span>));  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">                System.err.println(e.getMessage());  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// 创建文件夹  </span></span><br><span class="line">        savePath += dirName + <span class="string">"/"</span>;  </span><br><span class="line">        saveUrl += dirName + <span class="string">"/"</span>;  </span><br><span class="line">        File saveDirFile = <span class="keyword">new</span> File(savePath);  </span><br><span class="line">        <span class="keyword">if</span> (!saveDirFile.exists()) &#123;  </span><br><span class="line">            saveDirFile.mkdirs();  </span><br><span class="line">        &#125;  </span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMdd"</span>);  </span><br><span class="line">        String ymd = sdf.format(<span class="keyword">new</span> Date());  </span><br><span class="line">        savePath += ymd + <span class="string">"/"</span>;  </span><br><span class="line">        saveUrl += ymd + <span class="string">"/"</span>;  </span><br><span class="line">        File dirFile = <span class="keyword">new</span> File(savePath);  </span><br><span class="line">        <span class="keyword">if</span> (!dirFile.exists()) &#123;  </span><br><span class="line">            dirFile.mkdirs();  </span><br><span class="line">        &#125;  </span><br><span class="line">	<span class="comment">//标注 </span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;  </span><br><span class="line">            String fileName = fileNames[i];  </span><br><span class="line">            <span class="keyword">if</span>(fileTools.getSize(files[i]) &gt; maxSize)&#123;  </span><br><span class="line">                <span class="keyword">try</span> &#123;  </span><br><span class="line">                    response.getWriter().println(getError(<span class="string">"上传文件大小超过限制(&lt;2MB)。"</span>));  </span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">                    System.err.println(e.getMessage());  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">	    <span class="comment">// 检查扩展名  </span></span><br><span class="line">            String fileExt = fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>) + <span class="number">1</span>).toLowerCase();  </span><br><span class="line">            <span class="keyword">if</span> (!Arrays.&lt;String&gt; asList(extMap.get(dirName).split(<span class="string">","</span>)).contains(fileExt)) &#123;  </span><br><span class="line">                <span class="keyword">try</span> &#123;  </span><br><span class="line">                    response.getWriter().println(getError(<span class="string">"上传文件扩展名是不允许的扩展名。\n只允许"</span>+ extMap.get(dirName) + <span class="string">"格式。"</span>));  </span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">                    System.err.println(e.getMessage());  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">            SimpleDateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmss"</span>);  </span><br><span class="line">            String newFileName = df.format(<span class="keyword">new</span> Date()) + <span class="string">"_"</span>+ <span class="keyword">new</span> Random().nextInt(<span class="number">1000</span>) + <span class="string">"."</span> + fileExt;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">		<span class="comment">//标注 生成新的文件的路径  </span></span><br><span class="line">                String path = (savePath + <span class="string">"/"</span> + newFileName);  </span><br><span class="line">                <span class="comment">// 判断文件是否上传成功  </span></span><br><span class="line">                <span class="keyword">boolean</span> uploadFile = fileTools.uploadFile(files[i], path);  </span><br><span class="line">                <span class="keyword">if</span> (!uploadFile) &#123;  </span><br><span class="line">                    response.getWriter().println(getError(<span class="string">"上传文件失败。"</span>));  </span><br><span class="line">                &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">                <span class="keyword">try</span> &#123;  </span><br><span class="line">                    response.getWriter().print(getError(<span class="string">"上传文件失败。"</span>));  </span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e1) &#123;  </span><br><span class="line">                    e1.printStackTrace();  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">            JSONObject obj = <span class="keyword">new</span> JSONObject();  </span><br><span class="line">            obj.put(<span class="string">"error"</span>, <span class="number">0</span>);  </span><br><span class="line">            obj.put(<span class="string">"url"</span>, saveUrl + newFileName);  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                response.getWriter().println(obj.toJSONString());  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">                System.err.println(e.getMessage());  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//输出信息  </span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getError</span><span class="params">(String message)</span> </span>&#123;  </span><br><span class="line">        JSONObject obj = <span class="keyword">new</span> JSONObject();  </span><br><span class="line">        obj.put(<span class="string">"error"</span>, <span class="number">1</span>);  </span><br><span class="line">        obj.put(<span class="string">"message"</span>, message);  </span><br><span class="line">        <span class="keyword">return</span> obj.toJSONString();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码中重写的地方就是在Action中获取页面中kindeditor上传的文件这一块，原来的写法在action中获取不到文件，具体的原因是在action中将request转为了MultiPartRequestWrapper， 因此commons-fileupload这个包中的FileItem就不能使用了。于是就重写了这一块内容。具体思路是：首先从MultiPartRequestWrapper中获取文件名组和文件组，然后自己编写上传文件的工具类实现上传文件。（代码中增加 //标注 的地方）</p>
<p>6、配置struts文件中的action和平常的一样，值得注意的是在action中不用返回结果，因为我们在action输出了json格式的数据，无需返回结果。</p>
<p>7、将kindeditor编辑器放到页面中代码如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;  </span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;  </span><br><span class="line">&lt;!doctype html&gt;  </span><br><span class="line">&lt;html&gt;  </span><br><span class="line">&lt;head&gt;  </span><br><span class="line">    &lt;meta charset=<span class="string">"utf-8"</span> /&gt;  </span><br><span class="line">    &lt;title&gt;KindEditor JSP&lt;/title&gt;  </span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"kindeditor/themes/default/default.css"</span> /&gt;  </span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"kindeditor/plugins/code/prettify.css"</span> /&gt;  </span><br><span class="line">    &lt;script charset="utf-8" src="kindeditor/kindeditor.js"&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script charset="utf-8" src="kindeditor/lang/zh_CN.js"&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script charset="utf-8" src="kindeditor/plugins/code/prettify.js"&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script&gt;  </span><br><span class="line">        KindEditor.ready(function(K) &#123;  </span><br><span class="line">            <span class="keyword">var</span> editor1 = K.create(<span class="string">'textarea[name="content1"]'</span>, &#123;  </span><br><span class="line">                cssPath : <span class="string">'kindeditor/plugins/code/prettify.css'</span>,  </span><br><span class="line">                uploadJson : <span class="string">'uploadJsonAction.action'</span>,  </span><br><span class="line">                afterCreate : function() &#123;  </span><br><span class="line">                    <span class="keyword">var</span> self = <span class="keyword">this</span>;  </span><br><span class="line">                    K.ctrl(document, <span class="number">13</span>, function() &#123;  </span><br><span class="line">                        self.sync();  </span><br><span class="line">                        document.forms[<span class="string">'example'</span>].submit();  </span><br><span class="line">                    &#125;);  </span><br><span class="line">                    K.ctrl(self.edit.doc, <span class="number">13</span>, function() &#123;  </span><br><span class="line">                        self.sync();  </span><br><span class="line">                        document.forms[<span class="string">'example'</span>].submit();  </span><br><span class="line">                    &#125;);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;);  </span><br><span class="line">            prettyPrint();  </span><br><span class="line">        &#125;);  </span><br><span class="line">    &lt;/script&gt;  </span><br><span class="line">&lt;/head&gt;  </span><br><span class="line">&lt;body&gt;  </span><br><span class="line">    &lt;form name=<span class="string">"example"</span> method=<span class="string">"post"</span> action=<span class="string">"showText.action"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;  </span><br><span class="line">        &lt;textarea name="content1" cols="100" rows="8" style="width:700px;height:200px;visibility:hidden;"&gt;&lt;/textarea&gt;  </span><br><span class="line">        &lt;br /&gt;  </span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> name=<span class="string">"button"</span> value=<span class="string">"提交内容"</span> /&gt; (提交快捷键: Ctrl + Enter)  </span><br><span class="line">    &lt;/form&gt;  </span><br><span class="line">&lt;/body&gt;  </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>8、其中的文件管理由于项目中没有用到就没有去理会。这是我的测试文件结构图：<br><img src="http://img.blog.csdn.net/20131110112018093?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbWF4MTI2MzEz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"><br>测试效果图：<br><img src="http://img.blog.csdn.net/20131110112427515?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbWF4MTI2MzEz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"><br>图中化红色框的是用到的类，其他类暂时都没有用。</p>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>  &lt;注意其中的 import org.maxsoft.tools.FileTools; 是笔者简单实现了一个上传文件的工具类，功能如下：<br>  1、计算文件大小；<br>  2、上传文件到指定的目录</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="maxsoft"
      src="/images/apple-touch-icon-next.png">
  <p class="site-author-name" itemprop="name">maxsoft</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/maxsoft-bj" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;maxsoft-bj" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zylwlh810@163.com" title="E-Mail → mailto:zylwlh810@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">maxsoft</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">318k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">4:49</span>
</div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@latest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  















  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout: 3000,
        priority: true,
        ignores: [uri => uri.includes('#'),uri => uri == 'http://yoursite.com/page/4/',]
      });
      });
  </script>

</body>
</html>
